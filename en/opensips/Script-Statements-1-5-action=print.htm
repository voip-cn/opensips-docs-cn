<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
  <title>openSIPS | Documentation / Script Statements - ver 1.5 </title>
  <link rel='stylesheet' href="print.css" tppabs="http://www.opensips.org/pub/skins/print/print.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }
 
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

</head>
<body>
  <div id='printhead'>
    <h3>From openSIPS</h3>
    <h1 class='pagename'><a href="javascript:if(confirm(%27http://www.opensips.org/Documentation  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation%27" tppabs="http://www.opensips.org/Documentation">Documentation: Script Statements - ver 1.5 </a></h1>
  </div>
<!--PageText-->
<div id='wikitext'>
<h5>Documentation -&gt; <a class='wikilink' href="Manuals-action=print.htm" tppabs="http://www.opensips.org/Documentation/Manuals?action=print">Manuals</a> -&gt; <a class='wikilink' href="Manual-1-5-action=print.htm" tppabs="http://www.opensips.org/Documentation/Manual-1-5?action=print">Manual 1.5</a> -&gt; Script Statements</h5>
<hr />
<p><span style='font-size:83%'> Pages for other versions: <a class='wikilink' href="Script-Statements-2-2-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-2-2?action=print">devel</a> <a class='wikilink' href="Script-Statements-2-1-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-2-1?action=print">2.1</a> <a class='wikilink' href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Script-Statements-1-11?action=print  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Script-Statements-1-11?action=print%27" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-11?action=print">1.11</a>  Older versions: <a class='wikilink' href="Script-Statements-1-10-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-10?action=print">1.10</a> <a class='wikilink' href="Script-Statements-1-9-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-9?action=print">1.9</a> <a class='wikilink' href="Script-Statements-1-8-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-8?action=print">1.8</a> <a class='wikilink' href="Script-Statements-1-7-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-7?action=print">1.7</a> <a class='wikilink' href="Script-Statements-1-6-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-6?action=print">1.6</a> 1.5 <a class='wikilink' href="Script-Statements-1-4-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Statements-1-4?action=print">1.4</a> </span>
</p>
<p class='vspace'><br />
</p><table width='100%'><tr ><td  align='center'><span  style='color: #185662;'><span style='font-size:120%'><strong>Script Statements v1.5</strong></span></span></td></tr>
</table>
<div class='vspace'></div><table width='100%'><tr ><td  align='left'><a class='wikilink' href="Script-Operators-1-5-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-Operators-1-5?action=print">Prev</a></td><td  align='right'><a class='wikilink' href="Script-CoreFunctions-1-5-action=print.htm" tppabs="http://www.opensips.org/Documentation/Script-CoreFunctions-1-5?action=print">Next</a></td></tr>
</table><hr />
<div class='vspace'></div><div class='tocfloat'><p><a name='toc' id='toc'></a><b>Table of Content</b> (<a id="tocidtog" href="javascript:toggle('tocid');">hide</a>)</p><ol class='toc' id='tocid'><li>1.&nbsp;<a href='#toc1'>if</a></li><li>2.&nbsp;<a href='#toc2'>switch</a></li><li>3.&nbsp;<a href='#toc3'>while</a></li></ol></div>
<p class='vspace'>Statements you can use in the <strong>OpenSIPS</strong> config file while building the routing logic.
</p>
<div class='vspace'></div><h4><a name='toc1' id='toc1'></a>1.&nbsp;if</h4>
<p>IF-ELSE statement
</p>
<p class='vspace'>Prototype:
</p>
<div class='vspace'></div><pre class='escaped'>
    if (expr) {
       actions;
    } else {
       actions;
    }
</pre>
<p class='vspace'>The 'expr' should be a valid logical expression.
</p>
<p class='vspace'>The logical operators that can be used in the logical expressions:
</p>
<div class='vspace'></div><ul><li>== - equal
</li><li>!= - not equal
</li><li>=~ - regular expression matching  (e.g. $rU =~ '^1800*' is "$rU begins with 1800" )
</li><li>!~ - regular expression not-matching
</li><li>&gt; - greater
</li><li>&gt;= - greater or equal
</li><li>&lt; - less
</li><li>&lt;= - less or equal
</li><li>&amp;&amp; - logical AND
</li><li>|| - logical OR
</li><li>! - logical NOT
</li><li>[ ... ] - test operator - inside can be any arithmetic expression
</li></ul><p class='vspace'>Example of usage:
</p>
<div class='vspace'></div><pre class='escaped'>
    if ( is_method("INVITE") &amp;&amp; $rp==5060 )
    {
        log("this sip message is an invite\n");
    } else {
        log("this sip message is not an invite\n");
    }
</pre>
<div class='vspace'></div><h4><a name='toc2' id='toc2'></a>2.&nbsp;switch</h4>
<p>SWITCH statement - it can be used to test the value of a pseudo-variable. 
</p>
<p class='vspace'>IMPORTANT NOTE: 'break' can be used only to mark the end of a 'case' branch (as it is in shell scripts). If you are trying to use 'break' outside a 'case' block the script will return error -- you must use 'return' there.
</p>
<p class='vspace'>Example of usage:
</p><pre class='escaped'>
    route {
        route(my_logic);
        switch($retcode)
        {
            case -1:
                log("process INVITE requests here\n");
            break;
            case 1:
                log("process REGISTER requests here\n");
            break;
            case 2:
            case 3:
                log("process SUBSCRIBE and NOTIFY requests here\n");
            break;
            default:
                log("process other requests here\n");
       }

        # switch of R-URI username
        switch($rU)
        {
            case "101":
                log("destination number is 101\n");
            break;
            case "102":
                log("destination number is 102\n");
            break;
            case "103":
            case "104":
                log("destination number is 103 or 104\n");
            break;
            default:
                log("unknown destination number\n");
       }
    }

    route[my_logic]{
        if(is_method("INVITE"))
        {
            return(-1);
        };
        if(is_method("REGISTER"))
            return(1);
        }
        if(is_method("SUBSCRIBE"))
            return(2);
        }
        if(is_method("NOTIFY"))
            return(3);
        }
        return(-2);
    }
</pre>
<div class='vspace'></div><div class='round lrindent warning' > 
<p>Take care while using 'return' - 'return(0)' stops the execution of the script.
</p></div>
<div class='vspace'></div><h4><a name='toc3' id='toc3'></a>3.&nbsp;while</h4>
<p>while statement
</p>
<p class='vspace'>Example of usage:
</p><pre class='escaped'>
    $var(i) = 0;
    while($var(i) &lt; 10)
    {
        xlog("counter: $var(i)\n");
        $var(i) = $var(i) + 1;
    }
</pre>
</div>

  <div id='printfoot'>
    <div class='from'>Retrieved from http://www.opensips.org/Documentation/Script-Statements-1-5</div>
    <div class='lastmod'>Page last modified on August 05, 2013, at 03:08 PM</div></div>
<!--HTMLFooter-->
</body>
</html>
