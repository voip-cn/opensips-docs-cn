<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>openSIPS | Documentation / Tutorials-Presence-XcapClient | History</title>
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href="opensips.css" tppabs="http://www.opensips.org/pub/skins/opensips/opensips.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  .diffbox { width:570px; border-left:1px #999999 solid; margin-top:1.33em; }
  .diffauthor { font-weight:bold; }
  .diffchangesum { font-weight:bold; }
  .difftime { font-family:verdana,sans-serif; font-size:66%; 
    background-color:#dddddd; }
  .difftype { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; font-weight:bold; }
  .diffadd { border-left:5px #99ff99 solid; padding-left:5px; }
  .diffdel { border-left:5px #ffff99 solid; padding-left:5px; }
  .diffrestore { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; margin:1.5em 0px; }
  .diffmarkup { font-family:monospace; }  
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

  <link rel="icon" type="image/png" href="http://opensips.org/favicon.png">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','analytics.js'/*tpa=http://www.google-analytics.com/analytics.js*/,'ga');

  ga('create', 'UA-47615177-1', 'http://www.opensips.org/Documentation/opensips.org');
  ga('send', 'pageview');

	function resizeIframe(obj) {
	    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
		  }

  </script>

</head>
<body>
<div id="main">
<!--PageHeaderFmt-->
  <div id='wikilogo'>
  <img class="motto" src="motto.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/motto.jpg" width="328" height="40" alt="The new breed of communication engine.">
  <a href="javascript:if(confirm(%27http://www.opensips.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/%27" tppabs="http://www.opensips.org/"><img class="logo" src="logo2.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/logo2.jpg"
    alt='openSIPS' border='0' /></a>
 </div>
 <div id='wikihead'>
 <table border=0>
  <tr valign=top><td width=250>
   
  </td></tr>
  <tr><td width=250>
   <form action="http://www.opensips.org/">
   
    <input type='hidden' name='n' value='Documentation.Tutorials-Presence-XcapClient' />
    <input type='hidden' name='action' value='search' />

    <input type='text' name='q' id='formsubmit' value='' class='inputbox searchbox' />
	<input type='submit' id='formbutton' class='inputbutton searchbutton' value=' ' /></form>
  </td></tr>
  </table>
 </div>

<!--/PageHeaderFmt-->
<div id="osTopNav" >
	<div id="osTopNavLeft">
	</div>

	<div id="osTopNavRight">
	</div>

	<ul id="osTopNavList">
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/About/About  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/About/About%27" tppabs="http://www.opensips.org/About/About" title="About">About</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Downloads/Downloads  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Downloads/Downloads%27" tppabs="http://www.opensips.org/Downloads/Downloads" title="Download">Downloads</a>
		</li>
		<li>
			<a href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals" title="Documentation">Documentation</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Community/Foundation-Main  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Community/Foundation-Main%27" tppabs="http://www.opensips.org/Community/Foundation-Main" title="Community">Community</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Development/Development  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Development/Development%27" tppabs="http://www.opensips.org/Development/Development" title="Development">Development</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Support/Contact  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Support/Contact%27" tppabs="http://www.opensips.org/Support/Contact" title="Support">Support</a>
		</li>
	</ul>
</div>
<!--PageMenuFmt-->
<!--/PageMenuFmt-->
  <table width='100%' align="center" cellpadding='0' cellspacing='0' id='wikimid'>
    <tr>
<!--PageLeftFmt-->
      <td valign='top' bgcolor="#E2F8DA" id='wikileft'>
        <p class='sidehead'> <span  style='color: #185662;'> Documentation</span>
</p><ul><li><a class='wikilink' title='Manuals' href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals">Manuals</a>
</li><li><a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Advanced Tutorials</a>
</li><li><a class='wikilink' title='TipsFAQ' href="TipsFAQ.htm" tppabs="http://www.opensips.org/Documentation/TipsFAQ">Tips &amp; FAQ</a>
</li><li><a class='wikilink' title='Migration' href="Migration.htm" tppabs="http://www.opensips.org/Documentation/Migration">Version Migration</a>
</li><li><a class='wikilink' title='Webinars' href="Webinars.htm" tppabs="http://www.opensips.org/Documentation/Webinars">OpenSIPS Webinars</a>
</li><li><a class='wikilink' title='Troubleshooting' href="Troubleshooting.htm" tppabs="http://www.opensips.org/Documentation/Troubleshooting">Troubleshooting</a>
</li><li><a class='wikilink' title='Tools' href="Tools.htm" tppabs="http://www.opensips.org/Documentation/Tools">OpenSIPS Tools</a>
</li><li><a class='wikilink' title='Development-Tutorials' href="Development-Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Development-Tutorials">Devel Tutorial</a>
</li></ul><div class='vspace'></div>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        
<!--PageText-->
<div id='wikitext'>
<h2 class='wikiaction'>Documentation.Tutorials-Presence-XcapClient History</h2>
  <p><a href="Tutorials-Presence-XcapClient-action=diff&source=y&minor=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=diff&source=y&minor=y">Show minor edits</a> - <a href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=diff&source=n&minor=n  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=diff&source=n&minor=n%27" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=diff&source=n&minor=n">Show changes to output</a></p>
  <div id='wikidiff'>
      <div class='diffbox'><div class='difftime'>May 07, 2014, at 11:35 AM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 1-7 from:</div>
        <div class='diffdel'><div class='diffmarkup'>!!Resources -&gt; [[Resources.Documentation | Documentation]] -&gt; [[Resources.DocsPapPa | Presence]] -&gt; [[Resources.PresenceServer | Presence Server]] -&gt; Xcap_client module <br /><br />#[[#exp_parameters| Exported Parameters]]<br />#[[#devel_guide| Developer's Guide]]<br />#[[#module_readme| Module Readme]]<br /><br />[[#exp_parameters]]</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>!!!!! Documentation -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; [[Documentation/Tutorials-Presence|Presence]] -&gt; [[Documentation/Tutorials-Presence-PresenceServer|Presence Server]] -&gt; Xcap_client module <br />----<br />(:toc-float Table of Content:)<br /><br /></div></div>
        <div class='difftype'>Changed lines 11-12 from:</div>
        <div class='diffdel'><div class='diffmarkup'><br />[[#devel_guide]]</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>----<br /><br /></div></div>
        <div class='difftype'>Changed lines 78-79 from:</div>
        <div class='diffdel'><div class='diffmarkup'><br />#[[#module_readme]]</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>----<br /><br /></div></div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-XcapClient-action=edit&restore=diff-1399455310-1366823788-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=edit&restore=diff:1399455310:1366823788:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>April 24, 2013, at 07:16 PM 
        by <span class='diffauthor' title='109.99.235.212'>109.99.235.212</span> - </div>
        <div class='difftype'>Added lines 1-82:</div>
        <div class='diffadd'><div class='diffmarkup'>!!Resources -&gt; [[Resources.Documentation | Documentation]] -&gt; [[Resources.DocsPapPa | Presence]] -&gt; [[Resources.PresenceServer | Presence Server]] -&gt; Xcap_client module <br /><br />#[[#exp_parameters| Exported Parameters]]<br />#[[#devel_guide| Developer's Guide]]<br />#[[#module_readme| Module Readme]]<br /><br />[[#exp_parameters]]<br />!!!Exported Parameters<br />*''db_url(str)'': database URL<br />*''xcap_table(str)'': the name of the database table used for storing the XCAP documents retrieved from the XCAP servers<br />*''periodical_query(int)'': flag to disable periodical query as a method of checking if an update for a stored document occurred on the server; if this flag is unset, the server must have the capability to announce an update by issuing the exported MI command - '''refreshXcapDoc'''<br />*''query_period(int)'': the time interval in seconds at which the servers will be queried for updates (used if periodical_query flag is set)<br /><br />[[#devel_guide]]<br />!!!Developer's Guide<br />This module represents an XCAP client interface for OpenSIPS with retrieving capabilities only. It is meant to be used by other OpenSIPS modules that use XCAP storage. Now this module is used by '''presence_xml''' and '''rls''' modules. <br /><br />'''Presence_xml and xcap_client interaction(when integrated_xcap_client parameter is not set)'''\\<br />Presence_xml module assumes that in the database table 'xcap' there is always the newest version of an xcap document that he has previously sent a request for to xcap_client module.<br />When a searched document is not found in the table, a request is sent to the xcap_client module, saying it to retrieve the document from the xcap server in future synchronize the version in the database table with that on the server, by calling the function '''getNewDoc'''.<br /><br />The API contains the following functions:<br /><br />* xcap_get_elem_t '''get_elem'''<br />-&gt;typedef char* (*'''xcap_get_elem_t''')(xcap_get_req_t req, char** etag);<br />-&gt;This function retrieves an element from the excap server( either a hole document or a node from the document. <br /><br />* xcapGetNewDoc_t getNewDoc; <br />-&gt;typedef char* (*xcapGetNewDoc_t)(xcap_get_req_t req, str user, str domain);<br />-&gt;This function is a request to fetch the document indicated in the request strucuture and handle its update. Calling this function will ensures that in the database table will always be the updated version of the document.  <br /><br />-&gt;The argument of the two functions is a structure containing the request. It has the following fields:<br />** char* '''xcap_root''':    the path to the location where the XCAP documetns are stored ( includes the server address and the local path; ex: http://xcap-server.com/xcap-root/)<br />** unsigned '''int port''': the port where the server is listening , if different than default 80<br />** xcap_doc_sel_t '''doc_sel''': a structure that indicates the selection of the document<br />** xcap_node_sel_t* '''node_sel''': a structure that indicates the selection of the node inside the document <br />** char* '''etag''': an XCAP etag<br />** int '''match_type''': the way to use the etag for selection in the HTTP request; it can be IF_MATCH or IF_NONE_MATCH. <br /><br />The '''xcap_doc_sel_t''' has the following structure:<br />** str auid: application defined Unique ID<br />** int doc_type: the document type ; if can have one of the values: PRES_RULES, RESOURCE_LIST, RLS_SERVICE, PIDF_MANIPULATION.<br />** int type: the type of the path segment after the AUID  which must either be GLOBAL_TYPE (for &quot;global&quot;) or USERS_TYPE (for &quot;users&quot;)<br />** str xid: the XCAP User Identifier if type is USERS_TYPE<br />** str filename: the name of the file <br />Example: <br />For selecting a presence authorization rules document the strucuture is filed like this:<br />	xcap_doc_sel_t doc_sel;<br /><br />	doc_sel.auid.s= &quot;presence-rules&quot;;<br />	doc_sel.auid.len= strlen(&quot;presence-rules&quot;);<br />	doc_sel.doc_type= PRES_RULES;<br />	doc_sel.type= USERS_TYPE;<br />	doc_sel.xid= uri;<br />	doc_sel.filename.s= &quot;index&quot;;<br />	doc_sel.filename.len= 5;<br /><br />The '''xcap_node_sel_t'''  structure that identifies a node from a document can be constructed using functions from the API:<br />* xcap_nodeSel_init_t '''int_node_sel''': initializeaza o structura de tip <br />-&gt;typedef xcap_node_sel_t* (*'''xcap_nodeSel_init_t''' )(void);<br /><br />* xcap_nodeSel_add_step_t '''add_step''' : add<br />-&gt;typedef xcap_node_sel_t* (*'''xcap_nodeSel_add_step_t''')(xcap_node_sel_t* curr_sel, str* name, str* namespace, int pos, attr_test_t*  attr_test, str* extra_sel);<br />-&gt;The '''attr_test''' in the parameters list is to be used in case an attribute test should be made to select the node. The definition of the structure is:<br />-&gt;typedef struct att_test<br />-&gt;{<br />-&gt;	str name;<br />-&gt;	str value;<br />-&gt;}attr_test_t;<br /><br />* xcap_nodeSel_add_terminal_t add_terminal;<br />-&gt;typedef xcap_node_sel_t* (*xcap_nodeSel_add_terminal_t)(xcap_node_sel_t* curr_sel, char* attr_sel, char* namespace_sel, char* extra_sel );<br /><br />* xcap_nodeSel_free_t free_node_sel;<br />-&gt;typedef void (*xcap_nodeSel_free_t)(xcap_node_sel_t* node);<br /><br />There is also one function which allows registering a callback to be called by the module when a change occurs in a document:<br />* register_xcapcb_t register_xcb; /* function to register a callback to document changes*/<br /><br />#[[#module_readme]]<br />!!!Module Readme<br />You can read the modules's readme here .</div></div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-XcapClient-action=edit&restore=diff-1366823788-1366823788-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=edit&restore=diff:1366823788:1366823788:&preview=y">Restore</a></div></div></div>
  
<!--PageRightFmt--><!--/PageRightFmt--></td>
</tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
  <hr class="bottomline" /></td>
    <div class='footnav'>
	
      <a rel="nofollow" href="Tutorials-Presence-XcapClient-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=edit">Edit</a> |
      <a rel="nofollow" href="Tutorials-Presence-XcapClient-action=diff.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=diff">History</a> |
      <a rel="nofollow" href="Tutorials-Presence-XcapClient-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-XcapClient?action=print" target='_blank'>Print</a> |
      <a href="RecentChanges.htm" tppabs="http://www.opensips.org/Documentation/RecentChanges">Recent Changes</a> |
      <a href="javascript:if(confirm(%27http://www.opensips.org/Site/Search  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Site/Search%27" tppabs="http://www.opensips.org/Site/Search">Search</a></div>
    <div class='lastmod'>Page last modified on May 07, 2014, at 11:35 AM</div></div>
<!--HTMLFooter-->
</div>
</body>
</html>
