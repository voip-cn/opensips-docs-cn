<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
  <title>openSIPS | Documentation / Tutorials-EventInterface</title>
  <link rel='stylesheet' href="print.css" tppabs="http://www.opensips.org/pub/skins/print/print.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }
 
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

</head>
<body>
  <div id='printhead'>
    <h3>From openSIPS</h3>
    <h1 class='pagename'><a href="javascript:if(confirm(%27http://www.opensips.org/Documentation  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation%27" tppabs="http://www.opensips.org/Documentation">Documentation: Tutorials-EventInterface</a></h1>
  </div>
<!--PageText-->
<div id='wikitext'>
<h5>Documentation -&gt; <a class='wikilink' href="Tutorials-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials?action=print">Tutorials</a> -&gt; Event Interface</h5>
<hr />
<p class='vspace'>This page has been visited 4113 times.
</p><div class='tocfloat'><p><a name='toc' id='toc'></a><b>Table of Content</b> (<a id="tocidtog" href="javascript:toggle('tocid');">hide</a>)</p><ol class='toc' id='tocid'><li>1.&nbsp;<a href='#toc1'>Event Interface</a></li><li>2.&nbsp;<a href='#toc2'>Overview</a></li><li>3.&nbsp;<a href='#toc3'>Event Subscription</a><ol class='toc'><li>3.1&nbsp;<a href='#toc4'>MI Subscription</a></li><li>3.2&nbsp;<a href='#toc5'>Script Subscription</a></li><li>3.3&nbsp;<a href='#toc6'>Subscribers</a></li></ol></li><li>4.&nbsp;<a href='#toc7'>Events</a><ol class='toc'><li>4.1&nbsp;<a href='#toc8'>Events Name</a></li><li>4.2&nbsp;<a href='#toc9'>Raising an Event</a></li><li>4.3&nbsp;<a href='#toc10'>Events list</a></li><li>4.4&nbsp;<a href='#toc11'>Examples</a></li></ol></li><li>5.&nbsp;<a href='#toc12'>Transport Modules</a><ol class='toc'><li>5.1&nbsp;<a href='#toc13'>Datagram Messages</a></li><li>5.2&nbsp;<a href='#toc14'>RabbitMQ Messages</a></li><li>5.3&nbsp;<a href='#toc15'>XMLRPC Commands</a></li><li>5.4&nbsp;<a href='#toc16'>Routes</a></li></ol></li></ol></div>
<hr />
<p class='vspace'><strong> This tutorial is for OpenSIPS trunk/devel version</strong>
</p>
<div class='vspace'></div><h3><a name='toc1' id='toc1'></a>1.&nbsp; Event Interface</h3>
<p>The OpenSIPS Event Interface provides an easy way to notify external applications whenever certain events occur inside OpenSIPS. Basically it provides two interfaces: one for the OpenSIPS internal modules and core, that is used to advertise and raise events, and an interface for the external applications, allowing them to register for specific events, and notifying them when those events are triggered by the modules, core, or by the OpenSIPS script.
</p>
<div class='vspace'></div><hr />
<div class='vspace'></div><h3><a name='toc2' id='toc2'></a>2.&nbsp; Overview</h3>
<p>OpenSIPS can notify an external application using different transport protocols:
</p><ul><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_datagram  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_datagram%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_datagram" rel='nofollow'>event_datagram</a> - sends Datagrams over UDP or UNIX sockets
</li><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_rabbitmq  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_rabbitmq%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_rabbitmq" rel='nofollow'>event_rabbitmq</a> - sends an AMQP message to a RabbitMQ server
</li><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_xmlrpc  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_xmlrpc%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_xmlrpc" rel='nofollow'>event_xmlrpc</a> - issues a RPC command on a RPC server
</li><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_route  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_route%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_route" rel='nofollow'>event_route</a> - runs an OpenSIPS event_route
</li></ul><p class='vspace'>In order to receive an event notification, an external application has to subscribe for a specific event to the Event interface. This can be done either using an MI command, or can be done directly from the OpenSIPS script. The subscription command has to specify the event that the external application wants to register to, and a socket where the notification has to be sent. The format of the socket is different, depending on the transport module used (you can find more information about this in the module's documentation page). 
</p>
<p class='vspace'>When an event is triggered, the Event Interface will send to each application that is subscribed for that event a notification, using the desired transport type. The event details are packed differently for each transport module (consult the transport module's documentation page for more details).
</p>
<div class='vspace'></div><hr />
<div class='vspace'></div><h3><a name='toc3' id='toc3'></a>3.&nbsp; Event Subscription</h3>
<p>As mentioned above, an external application can subscribe for an event either using MI, or directly from OpenSIPS script. In the next sections we will describe the use case of each of them.
</p>
<div class='vspace'></div><h4><a name='toc4' id='toc4'></a>3.1&nbsp; MI Subscription</h4>
<p>An external application should subscribe for an event using MI commands when the subscription nature is very dynamic: it subscribes for a short period, receives notifications, then decides to unsubscribe and so on. The MI function used to subscribe for an event is <a class='wikilink' href="Interface-CoreMI-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreMI?action=print">event_subscribe</a>.
</p>
<p class='vspace'>For example, to subscribe for the E_PIKE_BLOCKED event for only 1200 seconds, an external application that listens on localhost, UDP port 8888, has to issue the following MI command:
</p>
<div class='vspace'></div><pre class='escaped'>
   $ opensipsctl fifo event_subscribe E_PIKE_BLOCKED udp:127.0.0.1:8888 1200
</pre>
<p class='vspace'>The first parameter is the name of the event (see <a class='wikilink' href="Tutorials-EventInterface-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-EventInterface?action=print">here</a>), the second parameter is the listening socket name (the format depends on the transport module used) and the last parameter is the expiration period expressed in seconds. Note that if the last parameter is missing, a default subscription period of 3600s (1h) is assumed.
</p>
<p class='vspace'>In order to unsubscribe for an event, the external application has to use the same event and socket used at subscription time, but specify an expiration time of 0. The following command unsubscribes the previously registered application.
</p>
<div class='vspace'></div><pre class='escaped'>
   $ opensipsctl fifo event_subscribe E_PIKE_BLOCKED udp:127.0.0.1:8888 0
</pre>
<div class='vspace'></div><h4><a name='toc5' id='toc5'></a>3.2&nbsp; Script Subscription</h4>
<p>The Event Interface allows the script writer to subscribe for an event directly from the OpenSIPS configuration script. This is usually used when a subscription is permanent, that never expires. For example a server that is continuously listening from events from OpenSIPS and process them accordingly. The command used to subscribe for an event from script is <a class='wikilink' href="Script-CoreFunctions-2-2.htm" tppabs="http://www.opensips.org/Documentation/Script-CoreFunctions?action=print">subscribe_event</a>.
</p>
<p class='vspace'>Usually these kind of subscriptions are permanent, therefore they should be registered at when OpenSIPS starts. Therefore this should be done in <em>startup_route</em>, but this is not a requirement, as the function can be used in any route.
</p>
<p class='vspace'>Here is an example of subscription for the E_PIKE_BLOCKED event at OpenSIPS startup, without any expire time, from the OpenSIPS configuration script:
</p>
<div class='vspace'></div><pre class='escaped'>
   startup_route() {
      subscribe_event("E_PIKE_BLOCKED", "udp:127.0.0.1:8888");
   }
</pre>
<p class='vspace'>If the script writer wants the subscription to expire after 1200 second, the third parameter of the <a class='wikilink' href="Script-CoreFunctions-2-2.htm" tppabs="http://www.opensips.org/Documentation/Script-CoreFunctions?action=print">subscribe_event</a> function can be specified:
</p>
<div class='vspace'></div><pre class='escaped'>
   timer_route[event_subscribe,3600] {
      subscribe_event("E_PIKE_BLOCKED", "udp:127.0.0.1:8888", 1200);
   }
</pre>
<div class='vspace'></div><h4><a name='toc6' id='toc6'></a>3.3&nbsp; Subscribers</h4>
<p>The <a class='wikilink' href="Interface-CoreMI-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreMI?action=print">subscribers_list</a> MI function, exported by the OpenSIPS Core, can be used to list all the external applications subscribed. It also allows you to filter the subscribers based on the event they are registered to. For more information consult the functions <a class='wikilink' href="Interface-CoreMI-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreMI?action=print">documentation</a> page.
</p>
<div class='vspace'></div><hr />
<h3><a name='toc7' id='toc7'></a>4.&nbsp; Events</h3>
<p>There are two types of events: static/predefined events, exported by OpenSIPS code and modules, and documented by each module, and dynamic events that can be raised by the script writer directly from the script. A few examples of predefined events:
</p>
<div class='vspace'></div><ul><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/pike  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/pike#id250185%27" tppabs="http://www.opensips.org/html/docs/modules/devel/pike#id250185" rel='nofollow'>E_PIKE_BLOCKED</a> - raised when <strong>pike</strong> module decides an IP should be blocked.
</li><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/rtpproxy  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/rtpproxy#id293509%27" tppabs="http://www.opensips.org/html/docs/modules/devel/rtpproxy#id293509" rel='nofollow'>E_RTPPROXY_STATUS</a> - raised when a RTPProxy connects or disconnects.
</li><li><a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/dispatcher  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/dispatcher#id293894%27" tppabs="http://www.opensips.org/html/docs/modules/devel/dispatcher#id293894" rel='nofollow'>E_DISPATCHER_STATUS</a> - raised by the <strong>dispatcher</strong> module when a destination address becomes active/inactive.
</li><li><a class='wikilink' href="Interface-CoreEvents-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreEvents?action=print">E_CORE_THRESHOLD</a> - raised when using debugging bottleneck detection and the limit is exceeded.
</li><li><a class='wikilink' href="Interface-CoreEvents-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreEvents?action=print">E_CORE_PKG_THRESHOLD</a> - raised when the private memory usage exceeds a certain limit.
</li><li><a class='wikilink' href="Interface-CoreEvents-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreEvents?action=print">E_CORE_SHM_THRESHOLD</a> - raised when the shared memory usage exceeds a certain limit.
</li></ul><div class='vspace'></div><h4><a name='toc8' id='toc8'></a>4.1&nbsp; Events Name</h4>
<p>Although there is not a strict events naming imposed by the Event Interface, it is a good practice for an event's name to follow the format <code>E_<em>MODULE</em>_<em>NAME</em></code>, where <em>MODULE</em> is the name of the module that exports the event, <strong>CORE</strong> if the event is exported by OpenSIPS core, and <strong>SCRIPT</strong> if it is a dynamic event raised from the script, and <em>NAME</em> is the name of the event.
</p>
<div class='vspace'></div><h4><a name='toc9' id='toc9'></a>4.2&nbsp; Raising an Event</h4>
<p>In order to raise an event from the script, the <a class='wikilink' href="Script-CoreFunctions-2-2.htm" tppabs="http://www.opensips.org/Documentation/Script-CoreFunctions?action=print">raise_event</a> function has to be used. The function receives one, two or three parameters, depending on the script writer needs. If the event has no parameters, then only the first parameter is needed - the event's name.
</p>
<p class='vspace'>If the script writer wants to attach some extra information to the event, then the second and optionally the third parameter has to be used. The extra information has to be stored in an AVP as values, for example:
</p>
<div class='vspace'></div><pre class='escaped'>
    $avp(values) = "value1";
    $avp(values) = "value2";
    ...
</pre>
<p class='vspace'>If the parameters also have some names, then a new AVP have to store them. Note that the number of values in the first AVP has to be the same as in the one for the attributes:
</p>
<div class='vspace'></div><pre class='escaped'>
    $avp(attributes) = "param1";
    $avp(values) = "value1";
    $avp(attributes) = "param2";
    $avp(values) = "value2";
    ...
</pre>
<p class='vspace'>In order to raise the event from the script, the following code has to be used:
</p>
<div class='vspace'></div><pre class='escaped'>
   raise_event("E_SCRIPT_EVENT");     # raises an event without any parameters

   raise_event("E_SCRIPT_EVENT", $avp(values));     # raises an event that has only values parameters

   raise_event("E_SCRIPT_EVENT", $avp(attributes), $avp(values));     # raises an event with multiple attribute-value pairs
</pre>
<div class='vspace'></div><h4><a name='toc10' id='toc10'></a>4.3&nbsp; Events list</h4>
<p>The <a class='wikilink' href="Interface-CoreMI-2-2.htm" tppabs="http://www.opensips.org/Documentation/Interface-CoreMI?action=print">events_list</a> function can be used to list all the available events.
</p>
<div class='vspace'></div><h4><a name='toc11' id='toc11'></a>4.4&nbsp; Examples</h4>
<p>A practical use case of dynamic events is raising an event from the script when the TCP load is greater than 80%:
</p>
<div class='vspace'></div><pre class='escaped'>
   route[TCP_LOAD_CHECK] {

      if ($stat(tcp-load) &gt; 80) {
         # raise the event, specifying the limit and the real load
         $avp(attrs) = "limit";
         $avp(vals) = 80;
         $avp(attrs) = "load";
         $avp(vals) = $stat(tcp-load);

         raise_event("E_SCRIPT_TCP_LOAD", $avp(attrs), $avp(vals));
      }
   }
</pre>
<p class='vspace'>Dynamic events can also be used for accounting purposes. For example, you could use three types of dynamic events to notify an external application regarding a call status.
</p>
<div class='vspace'></div><pre class='escaped'>
   # this route initializes the accounting variables
   route[ACC_VARS] {
      $avp(attrs) = NULL;
      $avp(vals) = NULL;
      $avp(attrs) = "from";
      $avp(vals) = $fU;
      if (has_totag()) {
         $avp(attrs) = "to";
         $avp(vals) = $rU;
      }
      ...
      $avp(attrs) = "callid";
      $avp(vals) = $ci;
      # populate attrs and vals with whatever extra info you need
   }

   route {
      ...
      if (!has_totag() &amp;&amp; is_method("INVITE"))) {
         route(ACC_VARS);
         raise_event("E_SCRIPT_CALL_START", $avp(attrs), $avp(vals));
         t_on_reply("acc");
      } else if is_method("CANCEL|BYE") {
         route(ACC_VARS);
         raise_event("E_SCRIPT_CALL_STOP", $avp(attrs), $avp(vals));
      }
      ...
   }

   onreply_route[acc] {
      ...
      if (t_check_status("200")) {
          route(ACC_VARS);
          raise_event("E_SCRIPT_CALL_ESTABLISHED", $avp(attrs), $avp(vals));
      }
      ...
   }
</pre>     
<div class='vspace'></div><hr />
<h3><a name='toc12' id='toc12'></a>5.&nbsp; Transport Modules</h3>
<p>There are several transport modules that can be used to notify an external application. At the time this tutorial was written, the following transport methods were supported:
</p>
<div class='vspace'></div><h4><a name='toc13' id='toc13'></a>5.1&nbsp; Datagram Messages</h4>
<p>External applications can be notified when OpenSIPS internal events are triggered using either UDP or UNIX datagrams. This allows programmers to write a simple UDP server that receives the notification and process it in the preferred programming language.
</p>
<p class='vspace'>In order to support this type of communication, the <a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_datagram  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_datagram%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_datagram" rel='nofollow'>event_datagram</a> module has to be loaded. Consult the module's documentation page for more information about subscription socket and encapsulation format.
</p>
<div class='vspace'></div><h4><a name='toc14' id='toc14'></a>5.2&nbsp; RabbitMQ Messages</h4>
<p>OpenSIPS can also communicate with a <a class='urllink' href="javascript:if(confirm(%27http://www.rabbitmq.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.rabbitmq.com/%27" tppabs="http://www.rabbitmq.com/" rel='nofollow'>RabbitMQ</a> server using the AMQP (Advanced Message Queuing Protocol) messages. This type of communication leverages all the features the queuing server has.
</p>
<p class='vspace'>The <a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_rabbitmq  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_rabbitmq%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_rabbitmq" rel='nofollow'>event_rabbitmq</a> module provides this functionality. Note that in this case, the "external application" is the RabbitMQ server, so you do not have the possibility to subscribe for events from it. Therefore the programmer should either use a different application to subscribe for the event, or subscribes for it directly from the OpenSIPS script (as discussed <a class='wikilink' href="Tutorials-EventInterface-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-EventInterface?action=print">here</a>). For more information please visit the module's documentation page.
</p>
<div class='vspace'></div><h4><a name='toc15' id='toc15'></a>5.3&nbsp; XMLRPC Commands</h4>
<p>OpenSIPS can also execute a remote XMLRPC command when an event is triggered. The module that handles the communication between the Event Interface and the XMLRPC server is <a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_xmlrpc  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_xmlrpc%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_xmlrpc" rel='nofollow'>event_xmlrpc</a>.
</p>
<div class='vspace'></div><h4><a name='toc16' id='toc16'></a>5.4&nbsp; Routes</h4>
<p>A special implementation of a transport module is the <a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_route  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_route%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_route" rel='nofollow'>event_route</a> module, which is used to handle events directly from the OpenSIPS script. This allows the script writer to modify OpenSIPS internal variables when an event is triggered, by writing a special route, called <a class='wikilink' href="Script-Routes-2-2.htm" tppabs="http://www.opensips.org/Documentation/Script-Routes?action=print">event_route</a>. The name of the route specifies the event that is handled by that route.
</p>
<p class='vspace'>In order to retrieve the parameters of the event, the <a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_route  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_route#id250042%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_route#id250042" rel='nofollow'>fetch_event_params</a> function has to be used. It receives a list of parameters names, and the pseudo-variables that they have to be assigned to. For more information consult the <a class='urllink' href="javascript:if(confirm(%27http://www.opensips.org/html/docs/modules/devel/event_route  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/html/docs/modules/devel/event_route%27" tppabs="http://www.opensips.org/html/docs/modules/devel/event_route" rel='nofollow'>event_route</a> documentation page.
</p>
<p class='vspace'>For example in order to specify a route that handles the <strong>E_PIKE_BLOCKED</strong> event, and prints the blocked IP, the OpenSIPS script has to contain the following code:
</p>
<div class='vspace'></div><pre class='escaped'>
   event_route[E_PIKE_BLOCKED] {
      fetch_event_params("ip=$avp(pike-ip)");
      xlog("IP $avp(pike-ip) has been blocked\n");
   }
</pre>
<p class='vspace'>Note that specifying the <strong>event_route</strong> will automatically subscribe the route for the event. Therefore there is no need for explicit subscribing (from either external application or script). The subscription never expires, unless otherwise specified using the <a class='wikilink' href="Script-CoreFunctions-2-2.htm" tppabs="http://www.opensips.org/Documentation/Script-CoreFunctions?action=print">subscribe_event</a> MI command.
</p>
</div>

  <div id='printfoot'>
    <div class='from'>Retrieved from http://www.opensips.org/Documentation/Tutorials-EventInterface</div>
    <div class='lastmod'>Page last modified on May 16, 2013, at 06:05 PM</div></div>
<!--HTMLFooter-->
</body>
</html>
