<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>openSIPS | Documentation / Tutorials-Presence-SimplePresConfig | History</title>
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href="opensips.css" tppabs="http://www.opensips.org/pub/skins/opensips/opensips.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  .diffbox { width:570px; border-left:1px #999999 solid; margin-top:1.33em; }
  .diffauthor { font-weight:bold; }
  .diffchangesum { font-weight:bold; }
  .difftime { font-family:verdana,sans-serif; font-size:66%; 
    background-color:#dddddd; }
  .difftype { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; font-weight:bold; }
  .diffadd { border-left:5px #99ff99 solid; padding-left:5px; }
  .diffdel { border-left:5px #ffff99 solid; padding-left:5px; }
  .diffrestore { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; margin:1.5em 0px; }
  .diffmarkup { font-family:monospace; }  
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

  <link rel="icon" type="image/png" href="http://opensips.org/favicon.png">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','analytics.js'/*tpa=http://www.google-analytics.com/analytics.js*/,'ga');

  ga('create', 'UA-47615177-1', 'http://www.opensips.org/Documentation/opensips.org');
  ga('send', 'pageview');

	function resizeIframe(obj) {
	    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
		  }

  </script>

</head>
<body>
<div id="main">
<!--PageHeaderFmt-->
  <div id='wikilogo'>
  <img class="motto" src="motto.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/motto.jpg" width="328" height="40" alt="The new breed of communication engine.">
  <a href="javascript:if(confirm(%27http://www.opensips.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/%27" tppabs="http://www.opensips.org/"><img class="logo" src="logo2.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/logo2.jpg"
    alt='openSIPS' border='0' /></a>
 </div>
 <div id='wikihead'>
 <table border=0>
  <tr valign=top><td width=250>
   
  </td></tr>
  <tr><td width=250>
   <form action="http://www.opensips.org/">
   
    <input type='hidden' name='n' value='Documentation.Tutorials-Presence-SimplePresConfig' />
    <input type='hidden' name='action' value='search' />

    <input type='text' name='q' id='formsubmit' value='' class='inputbox searchbox' />
	<input type='submit' id='formbutton' class='inputbutton searchbutton' value=' ' /></form>
  </td></tr>
  </table>
 </div>

<!--/PageHeaderFmt-->
<div id="osTopNav" >
	<div id="osTopNavLeft">
	</div>

	<div id="osTopNavRight">
	</div>

	<ul id="osTopNavList">
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/About/About  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/About/About%27" tppabs="http://www.opensips.org/About/About" title="About">About</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Downloads/Downloads  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Downloads/Downloads%27" tppabs="http://www.opensips.org/Downloads/Downloads" title="Download">Downloads</a>
		</li>
		<li>
			<a href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals" title="Documentation">Documentation</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Community/Foundation-Main  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Community/Foundation-Main%27" tppabs="http://www.opensips.org/Community/Foundation-Main" title="Community">Community</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Development/Development  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Development/Development%27" tppabs="http://www.opensips.org/Development/Development" title="Development">Development</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Support/Contact  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Support/Contact%27" tppabs="http://www.opensips.org/Support/Contact" title="Support">Support</a>
		</li>
	</ul>
</div>
<!--PageMenuFmt-->
<!--/PageMenuFmt-->
  <table width='100%' align="center" cellpadding='0' cellspacing='0' id='wikimid'>
    <tr>
<!--PageLeftFmt-->
      <td valign='top' bgcolor="#E2F8DA" id='wikileft'>
        <p class='sidehead'> <span  style='color: #185662;'> Documentation</span>
</p><ul><li><a class='wikilink' title='Manuals' href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals">Manuals</a>
</li><li><a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Advanced Tutorials</a>
</li><li><a class='wikilink' title='TipsFAQ' href="TipsFAQ.htm" tppabs="http://www.opensips.org/Documentation/TipsFAQ">Tips &amp; FAQ</a>
</li><li><a class='wikilink' title='Migration' href="Migration.htm" tppabs="http://www.opensips.org/Documentation/Migration">Version Migration</a>
</li><li><a class='wikilink' title='Webinars' href="Webinars.htm" tppabs="http://www.opensips.org/Documentation/Webinars">OpenSIPS Webinars</a>
</li><li><a class='wikilink' title='Troubleshooting' href="Troubleshooting.htm" tppabs="http://www.opensips.org/Documentation/Troubleshooting">Troubleshooting</a>
</li><li><a class='wikilink' title='Tools' href="Tools.htm" tppabs="http://www.opensips.org/Documentation/Tools">OpenSIPS Tools</a>
</li><li><a class='wikilink' title='Development-Tutorials' href="Development-Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Development-Tutorials">Devel Tutorial</a>
</li></ul><div class='vspace'></div>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        
<!--PageText-->
<div id='wikitext'>
<h2 class='wikiaction'>Documentation.Tutorials-Presence-SimplePresConfig History</h2>
  <p><a href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=diff&source=n&minor=n  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=diff&source=n&minor=n%27" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=diff&source=n&minor=n">Hide minor edits</a> - <a href="Tutorials-Presence-SimplePresConfig-action=diff&source=y&minor=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=diff&source=y&minor=y">Show changes to markup</a></p>
  <div id='wikidiff'>
      <div class='diffbox'><div class='difftime'>December 10, 2014, at 01:18 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Added line 63:</div>
        <div class='diffadd'><p>modparam("presence_xml", "force_active", 1)
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-SimplePresConfig-action=edit&restore=diff-1418213939-1412856446-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit&restore=diff:1418213939:1412856446:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>October 09, 2014, at 02:07 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 41-43 from:</div>
        <div class='diffdel'></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>loadmodule "presence_xml.so"
loadmodule "xcap.so"
</p>
</div>
        <div class='difftype'>Changed line 61 from:</div>
        <div class='diffdel'><p>modparam("presence","db_url","mysql://opensips:opensipsrw@localhost/opensips")
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>modparam("presence|xcap","db_url","mysql://opensips:opensipsrw@localhost/opensips")
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-SimplePresConfig-action=edit&restore=diff-1412856446-1412855524-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit&restore=diff:1412856446:1412855524:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>October 09, 2014, at 01:52 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 41-42 from:</div>
        <div class='diffdel'><p>loadmodule "presence_xml.so"
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Changed line 59 from:</div>
        <div class='diffdel'><p>modparam("presence|presence_xml","db_url","mysql://opensips:opensipsrw@localhost/opensips")
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>modparam("presence","db_url","mysql://opensips:opensipsrw@localhost/opensips")
</p>
</div>
        <div class='difftype'>Deleted line 60:</div>
        <div class='diffdel'><p>modparam("presence_xml","force_active",1)
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-SimplePresConfig-action=edit&restore=diff-1412855524-1404303871-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit&restore=diff:1412855524:1404303871:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>July 02, 2014, at 02:24 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 1-2 from:</div>
        <div class='diffdel'><p><a class='wikilink' title='Tutorials-Presence-PresenceServer' href="Tutorials-Presence-PresenceServer.htm#configuration#configuration" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceServer#configuration#configuration">&lt;- Back</a>
[++[@
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h5>Documentation -&gt; <a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Tutorials</a> -&gt; <a class='wikilink' title='Tutorials-Presence' href="Tutorials-Presence.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence">Presence</a> -&gt; <a class='wikilink' title='Tutorials-Presence-PresenceServer' href="Tutorials-Presence-PresenceServer.htm#configuration#configuration" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceServer#configuration#configuration">Presence Server</a> -&gt; Presence Server config file</h5>
<hr />
<p class='vspace'><br />
[@
</p>
</div>
        <div class='difftype'>Added line 8:</div>
        <div class='diffadd'><ol><li>OpenSIPS 1.11.x configuration file
</li></ol>
</div>
        <div class='difftype'>Changed line 10 from:</div>
        <div class='diffdel'><ol><li>OpenSIPS Presence Server without permission rules quick-start config script
</li></ol>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><ol><li>SIP Presence Server
</li></ol>
</div>
        <div class='difftype'>Changed line 12 from:</div>
        <div class='diffdel'></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Changed lines 14-22 from:</div>
        <div class='diffdel'><p>/* Uncomment these lines to enter debugging mode */ 
debug=7            # debug level (cmd line: -dddddddddd)
fork=no
log_stderror=yes
</p>
<p class='vspace'>check_via=no	# (cmd. line: -v)
dns=no          # (cmd. line: -r)
rev_dns=no      # (cmd. line: -R)
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>debug=3
fork=yes
log_stderror=no
</p>
<p class='vspace'>check_via=no
dns=no
rev_dns=no
</p>
</div>
        <div class='difftype'>Changed lines 24-25 from:</div>
        <div class='diffdel'><p>children=4
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>children=2
</p>
</div>
        <div class='difftype'>Changed lines 27-29 from:</div>
        <div class='diffdel'><p>mpath="/usr/local/lib/opensips/modules/"
</p>
<div class='vspace'></div>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>mpath="/usr/local/opensips/lib/modules/"
</p>
</div>
        <div class='difftype'>Added lines 31-32:</div>
        <div class='diffadd'><p>loadmodule "signaling.so"
loadmodule "tm.so"
</p>
</div>
        <div class='difftype'>Deleted line 35:</div>
        <div class='diffdel'><p>loadmodule "tm.so"
</p>
</div>
        <div class='difftype'>Added lines 37-39:</div>
        <div class='diffadd'><p>loadmodule "mi_fifo.so"
loadmodule "usrloc.so"
loadmodule "registrar.so"
</p>
</div>
        <div class='difftype'>Changed lines 42-46 from:</div>
        <div class='diffdel'><p>loadmodule "usrloc.so"
loadmodule "registrar.so"
loadmodule "mi_fifo.so"
loadmodule "signaling.so" 
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Deleted line 43:</div>
        <div class='diffdel'><ol><li>db_mysql.so must be loaded !
</li></ol>
</div>
        <div class='difftype'>Changed line 46 from:</div>
        <div class='diffdel'></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Changed lines 48-49 from:</div>
        <div class='diffdel'></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>modparam("mi_fifo","fifo_name","/tmp/opensips_fifo")
</p>
</div>
        <div class='difftype'>Changed lines 51-55 from:</div>
        <div class='diffdel'><ol><li>Uncomment this if you want to use SQL database 
</li><li>for persistent storage and comment the previous line
</li></ol><p>modparam("usrloc", "db_mode", 2)
modparam("usrloc", "db_url", "mysql://opensips:opensipsrw@127.0.0.1/opensips")
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>modparam("usrloc","db_mode",2)
modparam("usrloc","db_url","mysql://opensips:opensipsrw@localhost/opensips")
</p>
</div>
        <div class='difftype'>Deleted lines 56-57:</div>
        <div class='diffdel'><ol><li>If you set "calculate_ha1" parameter to yes (which true in this config), 
</li><li>uncomment also the following parameter)
</li></ol>
</div>
        <div class='difftype'>Changed lines 58-61 from:</div>
        <div class='diffdel'><ol><li>-- mi_fifo params --
</li></ol><p>modparam("mi_fifo","fifo_name", "/tmp/opensips_fifo")
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Changed lines 60-64 from:</div>
        <div class='diffdel'><p>modparam("presence|presence_xml", "db_url", "mysql://opensips:opensipsrw@127.0.0.1/opensips")
modparam("presence", "server_address", "sip:sa@10.10.10.10:5060" )
modparam("presence_xml", "force_active", 1)
</p>
<div class='vspace'></div>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>modparam("presence|presence_xml","db_url","mysql://opensips:opensipsrw@localhost/opensips")
modparam("presence","server_address","sip:sa@10.10.10.10:5060")
modparam("presence_xml","force_active",1)
</p>
<div class='vspace'></div>
</div>
        <div class='difftype'>Changed line 66 from:</div>
        <div class='diffdel'></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Deleted line 67:</div>
        <div class='diffdel'></div>
        <div class='difftype'>Changed lines 69-70 from:</div>
        <div class='diffdel'><pre>	# initial sanity checks 
	if (!mf_process_maxfwd_header("10")) {
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	# initial sanity checks
	if(!mf_process_maxfwd_header("10")) {
</pre>
</div>
        <div class='difftype'>Changed lines 75-78 from:</div>
        <div class='diffdel'><pre> 	if (has_totag()) {
		## sequential requests within a dialog should
		## take the path determined by record-routing
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	if (has_totag()) {
		# sequential requests within a dialog should
		# take the path determined by record-routing
</pre>
</div>
        <div class='difftype'>Changed lines 80-82 from:</div>
        <div class='diffdel'><pre>			## route it out to whatever destination was set by loose_route()
			## in $du (destination URI).
			route(RELAY);
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>			# route it out to whatever destination was set by loose_route()
			# in $du (destination URI).
			route(relay);
</pre>
</div>
        <div class='difftype'>Changed lines 84-88 from:</div>
        <div class='diffdel'><pre>			if ( is_method("ACK") ) {
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>			if (is_method("SUBSCRIBE") &amp;&amp; uri==myself) {
				# in-dialog subscribe requests
				route(handle_presence);
				exit;
			} else if ( is_method("ACK") ) {
</pre>
</div>
        <div class='difftype'>Changed lines 90-91 from:</div>
        <div class='diffdel'><pre>					## non loose-route, but stateful ACK; must be an ACK after 
					## a 487 or e.g. 404 from upstream server
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>					# non loose-route, but stateful ACK; must be an ACK after 
					# a 487 or e.g. 404 from upstream server
</pre>
</div>
        <div class='difftype'>Changed lines 95-96 from:</div>
        <div class='diffdel'><pre>					## ACK without matching transaction -&gt;
					## ignore and discard
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>					# ACK without matching transaction -&gt;
					# ignore and discard
</pre>
</div>
        <div class='difftype'>Changed lines 114-130 from:</div>
        <div class='diffdel'><pre>	## record routing
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	# authenticate if from local subscriber (uncomment to enable auth)
	# authenticate all initial non-REGISTER request that pretend to be
	# generated by local subscriber (domain from FROM URI is local)
	##if (!(method=="REGISTER") &amp;&amp; from_uri==myself) {
	##  if (!proxy_authorize("", "subscriber")) {
	##      proxy_challenge("", "0");
	##      exit;
	##  }
	##  if (!db_check_from()) {
	##      send_reply("403","Forbidden auth ID");
	##      exit;
	##  }
	##
	##  consume_credentials();
	##}

	# record routing
</pre>
</div>
        <div class='difftype'>Changed lines 133-137 from:</div>
        <div class='diffdel'><pre>	if (!uri==myself) {
		# mark routing logic in request
		append_hf("P-hint: outbound\r\n"); 
		route(RELAY);
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	if (uri!=myself) {
		# routing to other SIP domains
		route(relay);
</pre>
</div>
        <div class='difftype'>Changed lines 138-185 from:</div>
        <div class='diffdel'><pre>	## if the request is for other domain use UsrLoc
	## (in case, it does not work, use the following command
	## with proper names and addresses in it)
	if (uri==myself) {

		## presence handling
		if( is_method("PUBLISH|SUBSCRIBE"))
			route(PRESENCE);

		if ( is_method("REGISTER") ) {

			## Uncomment this if you want to use digest authentication
			#if (!www_authorize("opensips.org", "subscriber")) {
			#	www_challenge("opensips.org", "0");
			#	exit;
			#};

			save("location");
			exit;
		}

		## native SIP destinations are handled using our USRLOC DB
		if (!lookup("location")) {
			send_reply("404", "Not Found");
			exit;
		}
		append_hf("P-hint: usrloc applied\r\n");
	};

	route(RELAY);
</pre><p>}
</p>
<p class='vspace'>route[RELAY] {
</p><pre>	# send it out now
	if (!t_relay()) 
		sl_reply_error();
	exit;
</pre><p>}
</p>
<div class='vspace'></div><ol><li>presence handling route
</li></ol><p>route[PRESENCE]
{
</p><pre>	## absorb retransmissions
	if (!t_newtran()) {
	        sl_reply_error();
	        exit;
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	# SIP 2 SIP presence traffic
	if (is_method("PUBLISH|SUBSCRIBE")) {
		route(handle_presence);
		exit;
</pre>
</div>
        <div class='difftype'>Changed lines 145-147 from:</div>
        <div class='diffdel'><pre>	## handle presence requests
	if(is_method("PUBLISH")) {
		handle_publish();
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	if (is_method("REGISTER")) {

		# Uncomment this if you want to use digest authentication
		#if (!www_authorize("", "subscriber")) {
		#  www_challenge("", "0");
		#  exit;
		#}

		save("location");
		exit;
</pre>
</div>
        <div class='difftype'>Changed lines 156-160 from:</div>
        <div class='diffdel'><pre>	else if( is_method("SUBSCRIBE")) {
		handle_subscribe();
        };

	exit;
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	# native SIP destinations are handled using our USRLOC DB
	if(!lookup("location")) {
		send_reply("404","Not Found");
		exit;
	}

	route(relay);
</pre>
</div>
        <div class='difftype'>Changed lines 165-193 from:</div>
        <div class='diffdel'><p>@]++]
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p class='vspace'>route[relay]{
</p><pre>	# send it out
	if(!t_relay())
		sl_reply_error();

	exit;
</pre><p>}
</p>
<p class='vspace'>route[handle_presence]
{
</p><pre>	if(!t_newtran()){
		sl_reply_error();
		exit;
	}

	if (is_method("PUBLISH")) {
		handle_publish();
	} else

	if (is_method("SUBSCRIBE")) {
		handle_subscribe();
	}

	exit;
</pre><p>}
@]
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-SimplePresConfig-action=edit&restore=diff-1404303871-1403028931-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit&restore=diff:1404303871:1403028931:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>June 17, 2014, at 08:15 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Added lines 21-22:</div>
        <div class='diffadd'><ol><li>------------------ module loading ----------------------------------
</li></ol><p>mpath="/usr/local/lib/opensips/modules/"
</p>
</div>
        <div class='difftype'>Changed lines 24-39 from:</div>
        <div class='diffdel'><ol><li>
</li><li>uncomment the following lines for TLS support
</li><li>disable_tls = 0
</li><li>listen = tls:your_IP:5061
</li><li>tls_verify_server = 1
</li><li>tls_verify_client = 1
</li><li>tls_require_client_certificate = 0
</li><li>tls_method = TLSv1
</li><li>tls_certificate = "/usr/local/etc/opensips/tls/user/user-cert.pem"
</li><li>tls_private_key = "/usr/local/etc/opensips/tls/user/user-privkey.pem"
</li><li>tls_ca_list = "/usr/local/etc/opensips/tls/user/user-calist.pem"
<div class='vspace'></div></li><li>------------------ module loading ----------------------------------
</li></ol><p>mpath="/usr/local/lib/opensips/modules/"
</p>
<div class='vspace'></div>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'></div>
        <div class='difftype'>Added line 29:</div>
        <div class='diffadd'><p>loadmodule "sipmsgops.so"
</p>
</div>
        <div class='difftype'>Changed lines 37-38 from:</div>
        <div class='diffdel'><ol><li>for 1.5 you must load also signaling module; uncomment the next line
</li><li>loadmodule "signaling.so" 
</li></ol>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>loadmodule "signaling.so" 
</p>
</div>
        <div class='difftype'>Changed lines 41-42 from:</div>
        <div class='diffdel'><ol><li>loadmodule "/usr/local/lib/opensips/modules/auth.so"
</li><li>loadmodule "/usr/local/lib/opensips/modules/auth_db.so"
</li></ol>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><ol><li>loadmodule "auth.so"
</li><li>loadmodule "auth_db.so"
</li></ol>
</div>
        <div class='difftype'>Deleted line 53:</div>
        <div class='diffdel'><ol><li>
</li></ol>
</div>
        <div class='difftype'>Deleted line 54:</div>
        <div class='diffdel'><ol><li>
</li></ol>
</div>
        <div class='difftype'>Deleted line 56:</div>
        <div class='diffdel'><ol><li>
</li></ol>
</div>
        <div class='difftype'>Deleted lines 58-61:</div>
        <div class='diffdel'><ol><li>-- rr params --
</li><li>add value to ;lr param to make some broken UAs happy
</li></ol><p>modparam("rr", "enable_full_lr", 1)
</p>
</div>
        <div class='difftype'>Changed lines 73-74 from:</div>
        <div class='diffdel'><pre>	# initial sanity checks -- messages with
	# max_forwards==0, or excessively long requests
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	# initial sanity checks 
</pre>
</div>
        <div class='difftype'>Changed line 75 from:</div>
        <div class='diffdel'><pre>		sl_send_reply("483","Too Many Hops");
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		send_reply("483","Too Many Hops");
</pre>
</div>
        <div class='difftype'>Changed line 77 from:</div>
        <div class='diffdel'><pre>	};
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	}
</pre>
</div>
        <div class='difftype'>Changed lines 79-80 from:</div>
        <div class='diffdel'><pre>	if (msg:len &gt;=  2048 ) {
		sl_send_reply("513", "Message too big");
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre> 	if (has_totag()) {
		## sequential requests within a dialog should
		## take the path determined by record-routing
		if (loose_route()) {
			## route it out to whatever destination was set by loose_route()
			## in $du (destination URI).
			route(RELAY);
		} else {
			if ( is_method("ACK") ) {
				if ( t_check_trans() ) {
					## non loose-route, but stateful ACK; must be an ACK after 
					## a 487 or e.g. 404 from upstream server
					t_relay();
					exit;
				} else {
					## ACK without matching transaction -&gt;
					## ignore and discard
					exit;
				}
			}
			send_reply("404","Not here");
		}
</pre>
</div>
        <div class='difftype'>Changed lines 102-115 from:</div>
        <div class='diffdel'><pre>	};
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	}

	# CANCEL processing
	if (is_method("CANCEL")) {
		if (t_check_trans())
			t_relay();
		exit;
	}

	t_check_trans();

	## record routing
	if (!is_method("REGISTER|MESSAGE"))
		record_route();
</pre>
</div>
        <div class='difftype'>Changed lines 117-126 from:</div>
        <div class='diffdel'><pre>	# we record-route all messages -- to make sure that
	# subsequent messages will go through our proxy; that's
	# particularly good if upstream and downstream entities
	# use different transport protocol
	if (!method=="REGISTER")
		record_route();

	# subsequent messages withing a dialog should take the
	# path determined by record-routing
	if (loose_route()) {
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	if (!uri==myself) {
</pre>
</div>
        <div class='difftype'>Deleted lines 118-123:</div>
        <div class='diffdel'><pre>		append_hf("P-hint: rr-enforced\r\n"); 
		route(1);
	};

	if (!uri==myself) {
		# mark routing logic in request
</pre>
</div>
        <div class='difftype'>Changed lines 120-129 from:</div>
        <div class='diffdel'><pre>		# if you have some interdomain connections via TLS
		#if(uri=~"@tls_domain1.net") {
		#	t_relay("tls:domain1.net");
		#	exit;
		#} else if(uri=~"@tls_domain2.net") {
		#	t_relay("tls:domain2.net");
		#	exit;
		#}
		route(1);
	};
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		route(RELAY);
	}
</pre>
</div>
        <div class='difftype'>Changed lines 123-125 from:</div>
        <div class='diffdel'><pre>	# if the request is for other domain use UsrLoc
	# (in case, it does not work, use the following command
	# with proper names and addresses in it)
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	## if the request is for other domain use UsrLoc
	## (in case, it does not work, use the following command
	## with proper names and addresses in it)
</pre>
</div>
        <div class='difftype'>Changed line 128 from:</div>
        <div class='diffdel'><pre>		# presence handling
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		## presence handling
</pre>
</div>
        <div class='difftype'>Changed line 130 from:</div>
        <div class='diffdel'><pre>			route(2);
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>			route(PRESENCE);
</pre>
</div>
        <div class='difftype'>Changed line 132 from:</div>
        <div class='diffdel'><pre>		if (method=="REGISTER") {
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		if ( is_method("REGISTER") ) {
</pre>
</div>
        <div class='difftype'>Changed line 134 from:</div>
        <div class='diffdel'><pre>			# Uncomment this if you want to use digest authentication
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>			## Uncomment this if you want to use digest authentication
</pre>
</div>
        <div class='difftype'>Changed line 142 from:</div>
        <div class='diffdel'><pre>		};
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		}
</pre>
</div>
        <div class='difftype'>Changed line 144 from:</div>
        <div class='diffdel'><pre>		# native SIP destinations are handled using our USRLOC DB
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		## native SIP destinations are handled using our USRLOC DB
</pre>
</div>
        <div class='difftype'>Changed line 146 from:</div>
        <div class='diffdel'><pre>			sl_send_reply("404", "Not Found");
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>			send_reply("404", "Not Found");
</pre>
</div>
        <div class='difftype'>Changed lines 148-149 from:</div>
        <div class='diffdel'><pre>		};
		append_hf("P-hint: usrloc applied\r\n"); 
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>		}
		append_hf("P-hint: usrloc applied\r\n");
</pre>
</div>
        <div class='difftype'>Added lines 151-153:</div>
        <div class='diffadd'><pre>	route(RELAY);
</pre><p>}
</p>
</div>
        <div class='difftype'>Deleted lines 154-155:</div>
        <div class='diffdel'><pre>	route(1);
</pre><p>}
</p>
</div>
        <div class='difftype'>Added lines 156-161:</div>
        <div class='diffadd'><p>route[RELAY] {
</p><pre>	# send it out now
	if (!t_relay()) 
		sl_reply_error();
	exit;
</pre><p>}
</p>
</div>
        <div class='difftype'>Deleted lines 162-170:</div>
        <div class='diffdel'><p>route[1] {
</p><pre>	# send it out now; use stateful forwarding as it works reliably
	# even for UDP2TCP
	if (!t_relay()) {
		sl_reply_error();
	};
	exit;
</pre><p>}
</p>
</div>
        <div class='difftype'>Changed line 164 from:</div>
        <div class='diffdel'><p>route[2]
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>route[PRESENCE]
</p>
</div>
        <div class='difftype'>Changed lines 166-168 from:</div>
        <div class='diffdel'><pre>	# absorb retransmissions
	if (! t_newtran())
	{
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	## absorb retransmissions
	if (!t_newtran()) {
</pre>
</div>
        <div class='difftype'>Changed lines 170-175 from:</div>
        <div class='diffdel'><pre>	};

	#handle presence requests

	if(is_method("PUBLISH"))
	{
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	}

	## handle presence requests
	if(is_method("PUBLISH")) {
</pre>
</div>
        <div class='difftype'>Changed lines 175-177 from:</div>
        <div class='diffdel'><pre>		t_release();
                /* the call to t_release is no longer needed in 1.5 */
	} 
</pre>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><pre>	}
</pre>
</div>
        <div class='difftype'>Deleted lines 177-178:</div>
        <div class='diffdel'><pre>		t_release();
	        /* the call to t_release is no longer needed in 1.5 */
</pre>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-SimplePresConfig-action=edit&restore=diff-1403028931-1366968466-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit&restore=diff:1403028931:1366968466:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>April 26, 2013, at 11:27 AM 
        by <span class='diffauthor' title='109.99.235.212'>109.99.235.212</span> - </div>
        <div class='difftype'>Added lines 1-202:</div>
        <div class='diffadd'><p><a class='wikilink' title='Tutorials-Presence-PresenceServer' href="Tutorials-Presence-PresenceServer.htm#configuration#configuration" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceServer#configuration#configuration">&lt;- Back</a>
</p><span style='font-size:144%'><pre class='escaped'>
#
#
# OpenSIPS Presence Server without permission rules quick-start config script
#

# ----------- global configuration parameters ------------------------

/* Uncomment these lines to enter debugging mode */ 
debug=7            # debug level (cmd line: -dddddddddd)
fork=no
log_stderror=yes

check_via=no	# (cmd. line: -v)
dns=no          # (cmd. line: -r)
rev_dns=no      # (cmd. line: -R)
listen=udp:10.10.10.10:5060
children=4


#
# uncomment the following lines for TLS support
#disable_tls = 0
#listen = tls:your_IP:5061
#tls_verify_server = 1
#tls_verify_client = 1
#tls_require_client_certificate = 0
#tls_method = TLSv1
#tls_certificate = "/usr/local/etc/opensips/tls/user/user-cert.pem"
#tls_private_key = "/usr/local/etc/opensips/tls/user/user-privkey.pem"
#tls_ca_list = "/usr/local/etc/opensips/tls/user/user-calist.pem"

# ------------------ module loading ----------------------------------
mpath="/usr/local/lib/opensips/modules/"


loadmodule "db_mysql.so"
loadmodule "sl.so"
loadmodule "maxfwd.so"
loadmodule "textops.so"
loadmodule "tm.so"
loadmodule "rr.so"
loadmodule "presence.so"
loadmodule "presence_xml.so"
loadmodule "usrloc.so"
loadmodule "registrar.so"
loadmodule "mi_fifo.so"
# for 1.5 you must load also signaling module; uncomment the next line
#loadmodule "signaling.so" 

# Uncomment this if you want digest authentication
# db_mysql.so must be loaded !
#loadmodule "/usr/local/lib/opensips/modules/auth.so"
#loadmodule "/usr/local/lib/opensips/modules/auth_db.so"

# ----------------- setting module-specific parameters ---------------

# -- usrloc params --
# Uncomment this if you want to use SQL database 
# for persistent storage and comment the previous line
modparam("usrloc", "db_mode", 2)
modparam("usrloc", "db_url", "mysql://opensips:opensipsrw@127.0.0.1/opensips")

# -- auth params --
# Uncomment if you are using auth module
#
#modparam("auth_db", "calculate_ha1", yes)
#
# If you set "calculate_ha1" parameter to yes (which true in this config), 
# uncomment also the following parameter)
#
#modparam("auth_db", "password_column", "password")

# -- rr params --
# add value to ;lr param to make some broken UAs happy
modparam("rr", "enable_full_lr", 1)

# -- mi_fifo params --
modparam("mi_fifo","fifo_name", "/tmp/opensips_fifo")

# -- presence params --
modparam("presence|presence_xml", "db_url", "mysql://opensips:opensipsrw@127.0.0.1/opensips")
modparam("presence", "server_address", "sip:sa@10.10.10.10:5060" )
modparam("presence_xml", "force_active", 1)


# -------------------------  request routing logic -------------------

# main routing logic

route{
	# initial sanity checks -- messages with
	# max_forwards==0, or excessively long requests
	if (!mf_process_maxfwd_header("10")) {
		sl_send_reply("483","Too Many Hops");
		exit;
	};

	if (msg:len &gt;=  2048 ) {
		sl_send_reply("513", "Message too big");
		exit;
	};

	# we record-route all messages -- to make sure that
	# subsequent messages will go through our proxy; that's
	# particularly good if upstream and downstream entities
	# use different transport protocol
	if (!method=="REGISTER")
		record_route();

	# subsequent messages withing a dialog should take the
	# path determined by record-routing
	if (loose_route()) {
		# mark routing logic in request
		append_hf("P-hint: rr-enforced\r\n"); 
		route(1);
	};

	if (!uri==myself) {
		# mark routing logic in request
		append_hf("P-hint: outbound\r\n"); 
		# if you have some interdomain connections via TLS
		#if(uri=~"@tls_domain1.net") {
		#	t_relay("tls:domain1.net");
		#	exit;
		#} else if(uri=~"@tls_domain2.net") {
		#	t_relay("tls:domain2.net");
		#	exit;
		#}
		route(1);
	};

	# if the request is for other domain use UsrLoc
	# (in case, it does not work, use the following command
	# with proper names and addresses in it)
	if (uri==myself) {

		# presence handling
		if( is_method("PUBLISH|SUBSCRIBE"))
			route(2);

		if (method=="REGISTER") {

			# Uncomment this if you want to use digest authentication
			#if (!www_authorize("opensips.org", "subscriber")) {
			#	www_challenge("opensips.org", "0");
			#	exit;
			#};

			save("location");
			exit;
		};

		# native SIP destinations are handled using our USRLOC DB
		if (!lookup("location")) {
			sl_send_reply("404", "Not Found");
			exit;
		};
		append_hf("P-hint: usrloc applied\r\n"); 
	};

	route(1);
}


route[1] {
	# send it out now; use stateful forwarding as it works reliably
	# even for UDP2TCP
	if (!t_relay()) {
		sl_reply_error();
	};
	exit;
}

# presence handling route
route[2]
{
	# absorb retransmissions
	if (! t_newtran())
	{
	        sl_reply_error();
	        exit;
	};

	#handle presence requests

	if(is_method("PUBLISH"))
	{
		handle_publish();
		t_release();
                /* the call to t_release is no longer needed in 1.5 */
	} 
	else if( is_method("SUBSCRIBE")) {
		handle_subscribe();
		t_release();
	        /* the call to t_release is no longer needed in 1.5 */
        };

	exit;
}
</pre></span>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-SimplePresConfig-action=edit&restore=diff-1366968466-1366968466-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit&restore=diff:1366968466:1366968466:&preview=y">Restore</a></div></div></div>
  
<!--PageRightFmt--><!--/PageRightFmt--></td>
</tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
  <hr class="bottomline" /></td>
    <div class='footnav'>
	
      <a rel="nofollow" href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit%27" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=edit">Edit</a> |
      <a rel="nofollow" href="Tutorials-Presence-SimplePresConfig-action=diff.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=diff">History</a> |
      <a rel="nofollow" href="Tutorials-Presence-SimplePresConfig-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-SimplePresConfig?action=print" target='_blank'>Print</a> |
      <a href="RecentChanges.htm" tppabs="http://www.opensips.org/Documentation/RecentChanges">Recent Changes</a> |
      <a href="javascript:if(confirm(%27http://www.opensips.org/Site/Search  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Site/Search%27" tppabs="http://www.opensips.org/Site/Search">Search</a></div>
    <div class='lastmod'>Page last modified on December 10, 2014, at 01:18 PM</div></div>
<!--HTMLFooter-->
</div>
</body>
</html>
