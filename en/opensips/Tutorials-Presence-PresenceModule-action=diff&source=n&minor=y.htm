<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>openSIPS | Documentation / Tutorials-Presence-PresenceModule | History</title>
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href="opensips.css" tppabs="http://www.opensips.org/pub/skins/opensips/opensips.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  .diffbox { width:570px; border-left:1px #999999 solid; margin-top:1.33em; }
  .diffauthor { font-weight:bold; }
  .diffchangesum { font-weight:bold; }
  .difftime { font-family:verdana,sans-serif; font-size:66%; 
    background-color:#dddddd; }
  .difftype { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; font-weight:bold; }
  .diffadd { border-left:5px #99ff99 solid; padding-left:5px; }
  .diffdel { border-left:5px #ffff99 solid; padding-left:5px; }
  .diffrestore { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; margin:1.5em 0px; }
  .diffmarkup { font-family:monospace; }  
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

  <link rel="icon" type="image/png" href="http://opensips.org/favicon.png">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','analytics.js'/*tpa=http://www.google-analytics.com/analytics.js*/,'ga');

  ga('create', 'UA-47615177-1', 'http://www.opensips.org/Documentation/opensips.org');
  ga('send', 'pageview');

	function resizeIframe(obj) {
	    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
		  }

  </script>

</head>
<body>
<div id="main">
<!--PageHeaderFmt-->
  <div id='wikilogo'>
  <img class="motto" src="motto.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/motto.jpg" width="328" height="40" alt="The new breed of communication engine.">
  <a href="javascript:if(confirm(%27http://www.opensips.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/%27" tppabs="http://www.opensips.org/"><img class="logo" src="logo2.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/logo2.jpg"
    alt='openSIPS' border='0' /></a>
 </div>
 <div id='wikihead'>
 <table border=0>
  <tr valign=top><td width=250>
   
  </td></tr>
  <tr><td width=250>
   <form action="http://www.opensips.org/">
   
    <input type='hidden' name='n' value='Documentation.Tutorials-Presence-PresenceModule' />
    <input type='hidden' name='action' value='search' />

    <input type='text' name='q' id='formsubmit' value='' class='inputbox searchbox' />
	<input type='submit' id='formbutton' class='inputbutton searchbutton' value=' ' /></form>
  </td></tr>
  </table>
 </div>

<!--/PageHeaderFmt-->
<div id="osTopNav" >
	<div id="osTopNavLeft">
	</div>

	<div id="osTopNavRight">
	</div>

	<ul id="osTopNavList">
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/About/About  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/About/About%27" tppabs="http://www.opensips.org/About/About" title="About">About</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Downloads/Downloads  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Downloads/Downloads%27" tppabs="http://www.opensips.org/Downloads/Downloads" title="Download">Downloads</a>
		</li>
		<li>
			<a href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals" title="Documentation">Documentation</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Community/Foundation-Main  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Community/Foundation-Main%27" tppabs="http://www.opensips.org/Community/Foundation-Main" title="Community">Community</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Development/Development  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Development/Development%27" tppabs="http://www.opensips.org/Development/Development" title="Development">Development</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Support/Contact  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Support/Contact%27" tppabs="http://www.opensips.org/Support/Contact" title="Support">Support</a>
		</li>
	</ul>
</div>
<!--PageMenuFmt-->
<!--/PageMenuFmt-->
  <table width='100%' align="center" cellpadding='0' cellspacing='0' id='wikimid'>
    <tr>
<!--PageLeftFmt-->
      <td valign='top' bgcolor="#E2F8DA" id='wikileft'>
        <p class='sidehead'> <span  style='color: #185662;'> Documentation</span>
</p><ul><li><a class='wikilink' title='Manuals' href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals">Manuals</a>
</li><li><a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Advanced Tutorials</a>
</li><li><a class='wikilink' title='TipsFAQ' href="TipsFAQ.htm" tppabs="http://www.opensips.org/Documentation/TipsFAQ">Tips &amp; FAQ</a>
</li><li><a class='wikilink' title='Migration' href="Migration.htm" tppabs="http://www.opensips.org/Documentation/Migration">Version Migration</a>
</li><li><a class='wikilink' title='Webinars' href="Webinars.htm" tppabs="http://www.opensips.org/Documentation/Webinars">OpenSIPS Webinars</a>
</li><li><a class='wikilink' title='Troubleshooting' href="Troubleshooting.htm" tppabs="http://www.opensips.org/Documentation/Troubleshooting">Troubleshooting</a>
</li><li><a class='wikilink' title='Tools' href="Tools.htm" tppabs="http://www.opensips.org/Documentation/Tools">OpenSIPS Tools</a>
</li><li><a class='wikilink' title='Development-Tutorials' href="Development-Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Development-Tutorials">Devel Tutorial</a>
</li></ul><div class='vspace'></div>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        
<!--PageText-->
<div id='wikitext'>
<h2 class='wikiaction'>Documentation.Tutorials-Presence-PresenceModule History</h2>
  <p><a href="Tutorials-Presence-PresenceModule-action=diff&source=n&minor=n.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=diff&source=n&minor=n">Hide minor edits</a> - <a href="Tutorials-Presence-PresenceModule-action=diff&source=y&minor=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=diff&source=y&minor=y">Show changes to markup</a></p>
  <div id='wikidiff'>
      <div class='diffbox'><div class='difftime'>June 17, 2014, at 07:57 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 66-67 from:</div>
        <div class='diffdel'><h3>Exported Paramters</h3>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h3>Exported Parameters</h3>
</div>
        <div class='difftype'>Added lines 69-70:</div>
        <div class='diffadd'><hr />
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-PresenceModule-action=edit&restore=diff-1403027874-1403027828-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit&restore=diff:1403027874:1403027828:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>June 17, 2014, at 07:57 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 67-87 from:</div>
        <div class='diffdel'><ul><li><em>db_url</em> : database url
</li><li><em>presentity_table</em>: the name of the database table used for storing published info
</li><li><em>active_watchers_table</em>: the name of the database table used for storing Subscribe dialog info
</li><li><em>watchers_table</em>: the name of the database table used for storing subscription status for watchers
</li><li><em>clean_period</em> : time period for cleaning expired PUBLISH or SUBSCRIBE messages from database
</li><li><em>to_tag_pref</em> : prefix used when generating to_tag when sending replies for SUBSCRIBE requests
</li><li><em>expires_offset</em>' : the value that should be substracted from the expires value when sending a 200OK for a publish or subscribe to force the client cu send an update before the old request expires
</li><li><em>max_expires</em> : reduce validity of PUBLISH/SUBSCRIBE to this value if the Expires in request is greater.
</li><li><em>server_address</em>': presence server address to be included in Contact header field for Subscribe and Publish replies and in Notify messages.
</li><li><em>fallback2db</em>: parameter which enables a fallback to db mode of operation. In this mode, in case a searched record is not found in cache, the search is continued in database. Useful for an architecture in which processing and memory load might be divided on more machines using the same database.
</li><li><em>subs_htable_size</em>: the size of the hash table storing subscription dialogs(used as the power of 2 when computing table size)
</li><li><em>pres_htable_size</em>: the size of the hash table storing published info (used as the power of 2 when computing table size)
</li><li><em>enable_sphere_check</em>: a flag that should be set if privacy rules include sphere checking. The sphere information is expected to be present in the RPID body published by the presentity. The flag is introduced as this check requires extra processing that should be avoided if this feature is not supported by the clients.
</li></ul><hr />
<div class='vspace'></div><h3>Developer's Guide</h3>
<div class='vspace'></div><h4>Module Readme</h4>
<p>Please refer to the module's documentation.
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>Please refer to the module's documentation for the full list of parameters and a comprehensive description.
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-PresenceModule-action=edit&restore=diff-1403027828-1403027684-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit&restore=diff:1403027828:1403027684:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>June 17, 2014, at 07:54 PM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed line 87 from:</div>
        <div class='diffdel'><p>You can read the module's documentation here .
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><p>Please refer to the module's documentation.
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-PresenceModule-action=edit&restore=diff-1403027684-1399454946-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit&restore=diff:1403027684:1399454946:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>May 07, 2014, at 11:29 AM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed lines 1-8 from:</div>
        <div class='diffdel'><h2><a class='createlinktext' rel='nofollow' 
    href="Documentation-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Documentation?action=edit">Documentation</a><a rel='nofollow' 
    class='createlink' href="Documentation-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Documentation?action=edit">?</a> -&gt; <a class='wikilink' title='Tutorials-Presence' href="Tutorials-Presence.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence">Presence Tutorial</a> -&gt; <a class='wikilink' title='Tutorials-Presence-PresenceServer' href="Tutorials-Presence-PresenceServer.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceServer">Presence Server</a> -&gt; Presence Module - Parameters and Functions </h2>
<ol><li><a href='#exp_functions'>Exported Functions</a>
</li><li><a href='#exp_parameters'>Exported Parameters</a>
</li><li><a href='#devel_guide'>Developer's Guide</a>
</li><li><a href='#module_readme'>Module Readme</a>
</li></ol><p class='vspace'><a name='exp_functions' id='exp_functions'></a>
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h5>Documentation -&gt; <a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Tutorials</a> -&gt; <a class='wikilink' title='Tutorials-Presence' href="Tutorials-Presence.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence">Presence</a> -&gt; <a class='wikilink' title='Tutorials-Presence-PresenceServer' href="Tutorials-Presence-PresenceServer.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceServer">Presence Server</a> -&gt; Presence Module - Parameters and Functions</h5>
<hr />
<p>(:toc-float Table of Content:)
</p>
<div class='vspace'></div>
</div>
        <div class='difftype'>Changed lines 11-12 from:</div>
        <div class='diffdel'><h3>handle_publish()</h3>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h4>handle_publish()</h4>
</div>
        <div class='difftype'>Changed lines 37-38 from:</div>
        <div class='diffdel'><h3>handle_subscribe()</h3>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h4>handle_subscribe()</h4>
</div>
        <div class='difftype'>Changed lines 63-64 from:</div>
        <div class='diffdel'><p><a name='exp_parameters' id='exp_parameters'></a>
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><hr />
<div class='vspace'></div>
</div>
        <div class='difftype'>Changed lines 80-81 from:</div>
        <div class='diffdel'><p><a name='devel_guide' id='devel_guide'></a>
</p>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><hr />
<div class='vspace'></div>
</div>
        <div class='difftype'>Changed lines 85-86 from:</div>
        <div class='diffdel'><p><a name='module_readme' id='module_readme'></a>
</p><h3>Module Readme</h3>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h4>Module Readme</h4>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-PresenceModule-action=edit&restore=diff-1399454946-1368092234-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit&restore=diff:1399454946:1368092234:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>May 09, 2013, at 11:37 AM 
        by <span class='diffauthor' title='109.99.235.212'>109.99.235.212</span> - </div>
        <div class='difftype'>Changed line 1 from:</div>
        <div class='diffdel'><h2>Resources -&gt; <a class='wikilink' title='Documentation' href="javascript:if(confirm(%27http://www.opensips.org/Resources/Documentation  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Resources/Documentation%27" tppabs="http://www.opensips.org/Resources/Documentation">Documentation</a> -&gt; <a class='wikilink' title='DocsPapPa' href="javascript:if(confirm(%27http://www.opensips.org/Resources/DocsPapPa  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Resources/DocsPapPa%27" tppabs="http://www.opensips.org/Resources/DocsPapPa">Presence</a> -&gt; <a class='wikilink' title='PresenceServer' href="javascript:if(confirm(%27http://www.opensips.org/Resources/PresenceServer  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Resources/PresenceServer%27" tppabs="http://www.opensips.org/Resources/PresenceServer">Presence Server</a> -&gt; Presence Module - Parameters and Functions </h2>
</div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><h2><a class='createlinktext' rel='nofollow' 
    href="Documentation-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Documentation?action=edit">Documentation</a><a rel='nofollow' 
    class='createlink' href="Documentation-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Documentation?action=edit">?</a> -&gt; <a class='wikilink' title='Tutorials-Presence' href="Tutorials-Presence.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence">Presence Tutorial</a> -&gt; <a class='wikilink' title='Tutorials-Presence-PresenceServer' href="Tutorials-Presence-PresenceServer.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceServer">Presence Server</a> -&gt; Presence Module - Parameters and Functions </h2>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-PresenceModule-action=edit&restore=diff-1368092234-1366823538-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit&restore=diff:1368092234:1366823538:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>April 24, 2013, at 07:12 PM 
        by <span class='diffauthor' title='109.99.235.212'>109.99.235.212</span> - </div>
        <div class='difftype'>Added lines 1-88:</div>
        <div class='diffadd'><h2>Resources -&gt; <a class='wikilink' title='Documentation' href="javascript:if(confirm(%27http://www.opensips.org/Resources/Documentation  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Resources/Documentation%27" tppabs="http://www.opensips.org/Resources/Documentation">Documentation</a> -&gt; <a class='wikilink' title='DocsPapPa' href="javascript:if(confirm(%27http://www.opensips.org/Resources/DocsPapPa  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Resources/DocsPapPa%27" tppabs="http://www.opensips.org/Resources/DocsPapPa">Presence</a> -&gt; <a class='wikilink' title='PresenceServer' href="javascript:if(confirm(%27http://www.opensips.org/Resources/PresenceServer  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Resources/PresenceServer%27" tppabs="http://www.opensips.org/Resources/PresenceServer">Presence Server</a> -&gt; Presence Module - Parameters and Functions </h2>
<ol><li><a href='#exp_functions'>Exported Functions</a>
</li><li><a href='#exp_parameters'>Exported Parameters</a>
</li><li><a href='#devel_guide'>Developer's Guide</a>
</li><li><a href='#module_readme'>Module Readme</a>
</li></ol><p class='vspace'>
</p><h3>Exported Functions</h3>
<ul><li>handle_publish()
</li><li>handle_subscribe()
</li></ul><div class='vspace'></div><h3>handle_publish()</h3>
<ul><li>function which handles PUBLISH requests. It stores and updates presence information in database and calls functions to send NOTIFY messages when changes in presence information occur;
</li><li>it takes one optional parameter - the URI of the sender, used by the BLA feature( event dialog;sla ).
</li></ul><p class='vspace'><strong>Actions:</strong>
</p>
<div class='vspace'></div><ul><li>verifies if the PUBLISH message is correct: 
<ul><li>check its structure - calls an event specific function defined in a presence_ev module (presence_xml or presence_mwi);
</li><li>if it has a SIP-if-Match header, checks is there is a previous record for the same presentity;
</li><li>if not present checks if a body is present
</li></ul></li><li>if the conditions are not complied with it sends an adequate error message
</li><li>if a correct message:
<ul><li>sends a 200Ok message with 2 extra header fields : Expires and SIP-if-Match 
</li></ul></li><li>if a new PUBLISH without a Sip-if-Match header field 
<ul><li>it generates one
</li><li>inserts a new row in database
</li><li>calls a function which sends Notify with presence to all the watchers which have subscribed to the presentity
</li></ul></li><li>if the PUBLISH message is a sequential one
<ul><li>updates the expires value
</li><li>generates a new E-Tag and sends it in the Sip-Etag header of the 200OK reply 
</li></ul></li><li>if body present
<ul><li>updates body (replace with the new one) 
</li><li>calls a function which sends Notify with presence to all watchers 
</li></ul></li></ul><div class='vspace'></div><h3>handle_subscribe()</h3>
<ul><li>function which handles SUBSCRIBE requests. It stores or updates dialog information in and calls functions to send Notify messages to teh watcher and to the presentity (if a subscription for event presence.winfo exists for the presentity and the event) 
</li><li>it does not take any parameter.
</li></ul><p class='vspace'><strong>Actions</strong>
</p><ul><li>checks if the SUBSCRIBE message is correct: 
<ul><li>check its structure;
</li><li>if inside a dialog tries to match the dialogs with the records stored
</li></ul></li><li>if the conditions are not complied with it sends an adequate error message
</li><li>if a correct message sends 2XX reply
<ul><li>the reply contains an Expires header
</li><li>for SUBSCRIBE messages for event "presence.winfo" the status of the reply is 202OK  and for all the other 200OK
</li></ul></li><li>if a new SUBSCRIBE, saves the dialog information in cache
</li><li>if a Subscribe inside a dialog
<ul><li>if the Expires header field value is 0
<ul><li>deletes the registration from cache and database
</li><li>if event is a PUBLISH event - sends a Notify for winfo to the presentity with full state
</li></ul></li><li>if update
<ul><li>updates the expires value
</li><li>sends Notifies
</li></ul></li></ul></li><li>if a SUBSCRIBE for a PUBLISH event( 'presence', 'dialog.sla', 'message-summary'): 
<ul><li>sends Notify with presence.winfo to the presentity(if a winfo subscription from the presentity exists) with a partial state informing only about the subscription status of the new watcher
</li><li>sends Notify with the presence information
</li></ul></li><li>if a SUBSCRIBE for a winfo(watcher info) event
<ul><li>sends Notify with presence.winfo to the subscriber with full state informing about all the watchers
</li></ul></li></ul><p class='vspace'>
</p><h3>Exported Paramters</h3>
<ul><li><em>db_url</em> : database url
</li><li><em>presentity_table</em>: the name of the database table used for storing published info
</li><li><em>active_watchers_table</em>: the name of the database table used for storing Subscribe dialog info
</li><li><em>watchers_table</em>: the name of the database table used for storing subscription status for watchers
</li><li><em>clean_period</em> : time period for cleaning expired PUBLISH or SUBSCRIBE messages from database
</li><li><em>to_tag_pref</em> : prefix used when generating to_tag when sending replies for SUBSCRIBE requests
</li><li><em>expires_offset</em>' : the value that should be substracted from the expires value when sending a 200OK for a publish or subscribe to force the client cu send an update before the old request expires
</li><li><em>max_expires</em> : reduce validity of PUBLISH/SUBSCRIBE to this value if the Expires in request is greater.
</li><li><em>server_address</em>': presence server address to be included in Contact header field for Subscribe and Publish replies and in Notify messages.
</li><li><em>fallback2db</em>: parameter which enables a fallback to db mode of operation. In this mode, in case a searched record is not found in cache, the search is continued in database. Useful for an architecture in which processing and memory load might be divided on more machines using the same database.
</li><li><em>subs_htable_size</em>: the size of the hash table storing subscription dialogs(used as the power of 2 when computing table size)
</li><li><em>pres_htable_size</em>: the size of the hash table storing published info (used as the power of 2 when computing table size)
</li><li><em>enable_sphere_check</em>: a flag that should be set if privacy rules include sphere checking. The sphere information is expected to be present in the RPID body published by the presentity. The flag is introduced as this check requires extra processing that should be avoided if this feature is not supported by the clients.
</li></ul><p class='vspace'>
</p><h3>Developer's Guide</h3>
<p>
</p><h3>Module Readme</h3>
<p>You can read the module's documentation here .
</p>
</div></div>
      <div class='diffrestore'><a href="Tutorials-Presence-PresenceModule-action=edit&restore=diff-1366823538-1366823538-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit&restore=diff:1366823538:1366823538:&preview=y">Restore</a></div></div></div>
  
<!--PageRightFmt--><!--/PageRightFmt--></td>
</tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
  <hr class="bottomline" /></td>
    <div class='footnav'>
	
      <a rel="nofollow" href="Tutorials-Presence-PresenceModule-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=edit">Edit</a> |
      <a rel="nofollow" href="Tutorials-Presence-PresenceModule-action=diff.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=diff">History</a> |
      <a rel="nofollow" href="Tutorials-Presence-PresenceModule-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-Presence-PresenceModule?action=print" target='_blank'>Print</a> |
      <a href="RecentChanges.htm" tppabs="http://www.opensips.org/Documentation/RecentChanges">Recent Changes</a> |
      <a href="javascript:if(confirm(%27http://www.opensips.org/Site/Search  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Site/Search%27" tppabs="http://www.opensips.org/Site/Search">Search</a></div>
    <div class='lastmod'>Page last modified on June 17, 2014, at 07:57 PM</div></div>
<!--HTMLFooter-->
</div>
</body>
</html>
