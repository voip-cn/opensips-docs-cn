<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>openSIPS | Documentation / Tutorials-ConcurrentCallsLimitation-1-5 | History</title>
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href="opensips.css" tppabs="http://www.opensips.org/pub/skins/opensips/opensips.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  .diffbox { width:570px; border-left:1px #999999 solid; margin-top:1.33em; }
  .diffauthor { font-weight:bold; }
  .diffchangesum { font-weight:bold; }
  .difftime { font-family:verdana,sans-serif; font-size:66%; 
    background-color:#dddddd; }
  .difftype { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; font-weight:bold; }
  .diffadd { border-left:5px #99ff99 solid; padding-left:5px; }
  .diffdel { border-left:5px #ffff99 solid; padding-left:5px; }
  .diffrestore { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; margin:1.5em 0px; }
  .diffmarkup { font-family:monospace; }  
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

  <link rel="icon" type="image/png" href="http://opensips.org/favicon.png">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','analytics.js'/*tpa=http://www.google-analytics.com/analytics.js*/,'ga');

  ga('create', 'UA-47615177-1', 'http://www.opensips.org/Documentation/opensips.org');
  ga('send', 'pageview');

	function resizeIframe(obj) {
	    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
		  }

  </script>

</head>
<body>
<div id="main">
<!--PageHeaderFmt-->
  <div id='wikilogo'>
  <img class="motto" src="motto.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/motto.jpg" width="328" height="40" alt="The new breed of communication engine.">
  <a href="javascript:if(confirm(%27http://www.opensips.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/%27" tppabs="http://www.opensips.org/"><img class="logo" src="logo2.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/logo2.jpg"
    alt='openSIPS' border='0' /></a>
 </div>
 <div id='wikihead'>
 <table border=0>
  <tr valign=top><td width=250>
   
  </td></tr>
  <tr><td width=250>
   <form action="http://www.opensips.org/">
   
    <input type='hidden' name='n' value='Documentation.Tutorials-ConcurrentCallsLimitation-1-5' />
    <input type='hidden' name='action' value='search' />

    <input type='text' name='q' id='formsubmit' value='' class='inputbox searchbox' />
	<input type='submit' id='formbutton' class='inputbutton searchbutton' value=' ' /></form>
  </td></tr>
  </table>
 </div>

<!--/PageHeaderFmt-->
<div id="osTopNav" >
	<div id="osTopNavLeft">
	</div>

	<div id="osTopNavRight">
	</div>

	<ul id="osTopNavList">
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/About/About  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/About/About%27" tppabs="http://www.opensips.org/About/About" title="About">About</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Downloads/Downloads  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Downloads/Downloads%27" tppabs="http://www.opensips.org/Downloads/Downloads" title="Download">Downloads</a>
		</li>
		<li>
			<a href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals" title="Documentation">Documentation</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Community/Foundation-Main  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Community/Foundation-Main%27" tppabs="http://www.opensips.org/Community/Foundation-Main" title="Community">Community</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Development/Development  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Development/Development%27" tppabs="http://www.opensips.org/Development/Development" title="Development">Development</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Support/Contact  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Support/Contact%27" tppabs="http://www.opensips.org/Support/Contact" title="Support">Support</a>
		</li>
	</ul>
</div>
<!--PageMenuFmt-->
<!--/PageMenuFmt-->
  <table width='100%' align="center" cellpadding='0' cellspacing='0' id='wikimid'>
    <tr>
<!--PageLeftFmt-->
      <td valign='top' bgcolor="#E2F8DA" id='wikileft'>
        <p class='sidehead'> <span  style='color: #185662;'> Documentation</span>
</p><ul><li><a class='wikilink' title='Manuals' href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals">Manuals</a>
</li><li><a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Advanced Tutorials</a>
</li><li><a class='wikilink' title='TipsFAQ' href="TipsFAQ.htm" tppabs="http://www.opensips.org/Documentation/TipsFAQ">Tips &amp; FAQ</a>
</li><li><a class='wikilink' title='Migration' href="Migration.htm" tppabs="http://www.opensips.org/Documentation/Migration">Version Migration</a>
</li><li><a class='wikilink' title='Webinars' href="Webinars.htm" tppabs="http://www.opensips.org/Documentation/Webinars">OpenSIPS Webinars</a>
</li><li><a class='wikilink' title='Troubleshooting' href="Troubleshooting.htm" tppabs="http://www.opensips.org/Documentation/Troubleshooting">Troubleshooting</a>
</li><li><a class='wikilink' title='Tools' href="Tools.htm" tppabs="http://www.opensips.org/Documentation/Tools">OpenSIPS Tools</a>
</li><li><a class='wikilink' title='Development-Tutorials' href="Development-Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Development-Tutorials">Devel Tutorial</a>
</li></ul><div class='vspace'></div>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        
<!--PageText-->
<div id='wikitext'>
<h2 class='wikiaction'>Documentation.Tutorials-ConcurrentCallsLimitation-1-5 History</h2>
  <p><a href="Tutorials-ConcurrentCallsLimitation-1-5-action=diff&source=y&minor=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=diff&source=y&minor=y">Show minor edits</a> - <a href="Tutorials-ConcurrentCallsLimitation-1-5-action=diff&source=n&minor=n.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=diff&source=n&minor=n">Show changes to output</a></p>
  <div id='wikidiff'>
      <div class='diffbox'><div class='difftime'>August 17, 2015, at 06:14 PM 
        by <span class='diffauthor' title='78.96.148.62'>78.96.148.62</span> - </div>
        <div class='difftype'>Changed line 6 from:</div>
        <div class='diffdel'><div class='diffmarkup'>Using the new 'dialog' module released with the '''1.5x branch'''', it is now possible to easily impose channel limits within existing routing configurations. The example included below is a sample route block that integrates outbound channel limits with call control prepaid account support. Note that the example requires an AVP variable 'channels' to be set as user preference and can be adapted for both outbound and inbound channel limits using the existing profile architecture of the dialog module. </div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>Using the new 'dialog' module released with the '''1.5x branch''', it is now possible to easily impose channel limits within existing routing configurations. The example included below is a sample route block that integrates outbound channel limits with call control prepaid account support. Note that the example requires an AVP variable 'channels' to be set as user preference and can be adapted for both outbound and inbound channel limits using the existing profile architecture of the dialog module. </div></div></div>
      <div class='diffrestore'><a href="Tutorials-ConcurrentCallsLimitation-1-5-action=edit&restore=diff-1439828057-1439828045-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=edit&restore=diff:1439828057:1439828045:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>August 17, 2015, at 06:14 PM 
        by <span class='diffauthor' title='78.96.148.62'>78.96.148.62</span> - </div>
        <div class='difftype'>Changed line 1 from:</div>
        <div class='diffdel'><div class='diffmarkup'>!!!!!Documentation -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; Concurrent calls limitation</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>!!!!!Documentation -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; Concurrent calls limitation 1.5</div></div>
        <div class='difftype'>Changed line 6 from:</div>
        <div class='diffdel'><div class='diffmarkup'>Using the new 'dialog' module released with the upcoming 1.5x branch, it is now possible to easily impose channel limits within existing routing configurations. The example included below is a sample route block that integrates outbound channel limits with call control prepaid account support. Note that the example requires an AVP variable 'channels' to be set as user preference and can be adapted for both outbound and inbound channel limits using the existing profile architecture of the dialog module. </div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>Using the new 'dialog' module released with the '''1.5x branch'''', it is now possible to easily impose channel limits within existing routing configurations. The example included below is a sample route block that integrates outbound channel limits with call control prepaid account support. Note that the example requires an AVP variable 'channels' to be set as user preference and can be adapted for both outbound and inbound channel limits using the existing profile architecture of the dialog module. </div></div></div>
      <div class='diffrestore'><a href="Tutorials-ConcurrentCallsLimitation-1-5-action=edit&restore=diff-1439828045-1439827980-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=edit&restore=diff:1439828045:1439827980:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>August 17, 2015, at 06:13 PM 
        by <span class='diffauthor' title='78.96.148.62'>78.96.148.62</span> - </div>
        <div class='difftype'>Added lines 1-99:</div>
        <div class='diffadd'><div class='diffmarkup'>!!!!!Documentation -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; Concurrent calls limitation<br />----<br />This page has been visited {$PageCount} times.<br /><br /><br />Using the new 'dialog' module released with the upcoming 1.5x branch, it is now possible to easily impose channel limits within existing routing configurations. The example included below is a sample route block that integrates outbound channel limits with call control prepaid account support. Note that the example requires an AVP variable 'channels' to be set as user preference and can be adapted for both outbound and inbound channel limits using the existing profile architecture of the dialog module. <br /><br /><br />[@<br />....<br /># define the profile<br />modparam(&quot;dialog&quot;, &quot;profiles_with_value&quot;, &quot;caller&quot;)<br />....<br /><br /># Example route block:<br />#   this example should be called before the t_relay() function of an outbound invite<br />#<br />########################################################################<br /># Request route 'callcontrol' with channel limit<br />########################################################################<br /><br />route[39]<br />{<br />	## have we done our checking on this call?<br />	if(!isflagset(31))<br />	{<br />		# user has max channel limit set as preference<br />		if(is_avp_set(&quot;$avp(s:channels)/n&quot;) &amp;&amp; avp_check(&quot;$avp(s:channels)&quot;, &quot;gt/i:0&quot;))<br />		{<br />			# get current calls for uuid<br />			get_profile_size(&quot;caller&quot;,&quot;$avp(s:caller_uuid)&quot;,&quot;$var(calls)&quot;);	<br /><br />			# check within limit<br />			if($avp(s:channels) &gt; $var(calls))<br />			{<br />				xlog(&quot;L_INFO&quot;, &quot;Call control: user '$avp(s:caller_uuid)' currently has <br />				   '$var(calls)' of '$avp(s:channels)' active calls before this one\n&quot;);<br />				$var(setprofile) = 1;<br />			}<br />			else<br />			{<br />				xlog(&quot;L_INFO&quot;, &quot;Call control: user channel limit exceeded [$var(calls)/$avp(s:channels)]\n&quot;);<br />				send_reply(&quot;487&quot;, &quot;Request Terminated: Channel limit exceeded\n&quot;);<br />				exit;<br />			}<br />		}<br />		else<br />		{<br />			$var(setprofile) = 0;<br />		}<br /><br />		call_control();<br /><br />       	 	switch ($retcode) <br />		{<br />        		case 2:<br />            			# Call with no limit<br />        		case 1:<br />            			# Call with a limit under callcontrol management (either prepaid or postpaid)<br />            			break;<br />        		case -1:<br />            			# Not enough credit (prepaid call)<br />            			xlog(&quot;L_INFO&quot;, &quot;Call control: not enough credit for prepaid call\n&quot;);<br />            			acc_rad_request(&quot;402&quot;);<br />            			sl_send_reply(&quot;402&quot;, &quot;Not enough credit&quot;);<br />            			exit;<br />            			break;<br />        		case -2:<br />           			# Locked by call in progress (prepaid call)<br />             			xlog(&quot;L_INFO&quot;, &quot;Call control: prepaid call locked by another call in progress\n&quot;);<br />             			acc_rad_request(&quot;403&quot;);<br />             			sl_send_reply(&quot;403&quot;, &quot;Call locked by another call in progress&quot;);<br />             			exit;<br />             			break;<br />        		default:<br />            			# Internal error (message parsing, communication, ...)<br />            			xlog(&quot;L_INFO&quot;, &quot;Call control: internal server error\n&quot;);<br />            			acc_rad_request(&quot;500&quot;);<br />            			sl_send_reply(&quot;500&quot;, &quot;Internal server error&quot;);<br />            			exit;<br />        	}<br /><br />		if($var(setprofile) &gt; 0)<br />		{<br />			create_dialog();<br />			set_dlg_profile(&quot;caller&quot;,&quot;$avp(s:caller_uuid)&quot;);<br />		}<br /><br />		## mark checking done<br />		setflag(31);<br />	}<br />}<br />@]<br /><br />----<br /><br /><br /><br />(:commentboxchrono:)</div></div></div>
      <div class='diffrestore'><a href="Tutorials-ConcurrentCallsLimitation-1-5-action=edit&restore=diff-1439827980-1439827980-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=edit&restore=diff:1439827980:1439827980:&preview=y">Restore</a></div></div></div>
  
<!--PageRightFmt--><!--/PageRightFmt--></td>
</tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
  <hr class="bottomline" /></td>
    <div class='footnav'>
	
      <a rel="nofollow" href="Tutorials-ConcurrentCallsLimitation-1-5-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=edit">Edit</a> |
      <a rel="nofollow" href="Tutorials-ConcurrentCallsLimitation-1-5-action=diff.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=diff">History</a> |
      <a rel="nofollow" href="Tutorials-ConcurrentCallsLimitation-1-5-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-ConcurrentCallsLimitation-1-5?action=print" target='_blank'>Print</a> |
      <a href="RecentChanges.htm" tppabs="http://www.opensips.org/Documentation/RecentChanges">Recent Changes</a> |
      <a href="javascript:if(confirm(%27http://www.opensips.org/Site/Search  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Site/Search%27" tppabs="http://www.opensips.org/Site/Search">Search</a></div>
    <div class='lastmod'>Page last modified on August 17, 2015, at 06:14 PM</div></div>
<!--HTMLFooter-->
</div>
</body>
</html>
