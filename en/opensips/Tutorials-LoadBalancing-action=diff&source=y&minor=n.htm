<!DOCTYPE html 
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <title>openSIPS | Documentation / Tutorials-LoadBalancing | History</title>
  <meta http-equiv='Content-Style-Type' content='text/css' />
  <link rel='stylesheet' href="opensips.css" tppabs="http://www.opensips.org/pub/skins/opensips/opensips.css" type='text/css' />
  <!--HTMLHeader--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 4px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
  div.faqtoc div.faq * { display:none; }
  div.faqtoc div.faq p.question 
    { display:block; font-weight:normal; margin:0.5em 0 0.5em 20px; line-height:normal; }
  div.faqtoc div.faq p.question * { display:inline; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  .diffbox { width:570px; border-left:1px #999999 solid; margin-top:1.33em; }
  .diffauthor { font-weight:bold; }
  .diffchangesum { font-weight:bold; }
  .difftime { font-family:verdana,sans-serif; font-size:66%; 
    background-color:#dddddd; }
  .difftype { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; font-weight:bold; }
  .diffadd { border-left:5px #99ff99 solid; padding-left:5px; }
  .diffdel { border-left:5px #ffff99 solid; padding-left:5px; }
  .diffrestore { clear:both; font-family:verdana,sans-serif; 
    font-size:66%; margin:1.5em 0px; }
  .diffmarkup { font-family:monospace; }  
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script>
  <link href="commentboxplus.css" tppabs="http://www.opensips.org/pub/commentboxplus/commentboxplus.css" rel='stylesheet' type='text/css' />
  <link rel='stylesheet' href="wsplus.css" tppabs="http://www.opensips.org/pub/wsplus/wsplus.css" 
    type='text/css' />
  <!--[if IE]><style type='text/css' media='screen'>
    body { behavior:url("csshover.htc")/*tpa=http://www.opensips.org/pub/wsplus/csshover.htc*/; }
    .rollover * { visibility: visible; }
  </style><![endif]-->
  <meta name='robots' content='noindex,nofollow' />

  <link rel="icon" type="image/png" href="http://opensips.org/favicon.png">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','analytics.js'/*tpa=http://www.google-analytics.com/analytics.js*/,'ga');

  ga('create', 'UA-47615177-1', 'http://www.opensips.org/Documentation/opensips.org');
  ga('send', 'pageview');

	function resizeIframe(obj) {
	    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
		  }

  </script>

</head>
<body>
<div id="main">
<!--PageHeaderFmt-->
  <div id='wikilogo'>
  <img class="motto" src="motto.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/motto.jpg" width="328" height="40" alt="The new breed of communication engine.">
  <a href="javascript:if(confirm(%27http://www.opensips.org/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/%27" tppabs="http://www.opensips.org/"><img class="logo" src="logo2.jpg" tppabs="http://www.opensips.org/pub/skins/opensips/images/logo2.jpg"
    alt='openSIPS' border='0' /></a>
 </div>
 <div id='wikihead'>
 <table border=0>
  <tr valign=top><td width=250>
   
  </td></tr>
  <tr><td width=250>
   <form action="http://www.opensips.org/">
   
    <input type='hidden' name='n' value='Documentation.Tutorials-LoadBalancing' />
    <input type='hidden' name='action' value='search' />

    <input type='text' name='q' id='formsubmit' value='' class='inputbox searchbox' />
	<input type='submit' id='formbutton' class='inputbutton searchbutton' value=' ' /></form>
  </td></tr>
  </table>
 </div>

<!--/PageHeaderFmt-->
<div id="osTopNav" >
	<div id="osTopNavLeft">
	</div>

	<div id="osTopNavRight">
	</div>

	<ul id="osTopNavList">
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/About/About  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/About/About%27" tppabs="http://www.opensips.org/About/About" title="About">About</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Downloads/Downloads  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Downloads/Downloads%27" tppabs="http://www.opensips.org/Downloads/Downloads" title="Download">Downloads</a>
		</li>
		<li>
			<a href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals" title="Documentation">Documentation</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Community/Foundation-Main  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Community/Foundation-Main%27" tppabs="http://www.opensips.org/Community/Foundation-Main" title="Community">Community</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Development/Development  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Development/Development%27" tppabs="http://www.opensips.org/Development/Development" title="Development">Development</a>
		</li>
		<li>
			<a href="javascript:if(confirm(%27http://www.opensips.org/Support/Contact  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Support/Contact%27" tppabs="http://www.opensips.org/Support/Contact" title="Support">Support</a>
		</li>
	</ul>
</div>
<!--PageMenuFmt-->
<!--/PageMenuFmt-->
  <table width='100%' align="center" cellpadding='0' cellspacing='0' id='wikimid'>
    <tr>
<!--PageLeftFmt-->
      <td valign='top' bgcolor="#E2F8DA" id='wikileft'>
        <p class='sidehead'> <span  style='color: #185662;'> Documentation</span>
</p><ul><li><a class='wikilink' title='Manuals' href="Manuals.htm" tppabs="http://www.opensips.org/Documentation/Manuals">Manuals</a>
</li><li><a class='wikilink' title='Tutorials' href="Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Tutorials">Advanced Tutorials</a>
</li><li><a class='wikilink' title='TipsFAQ' href="TipsFAQ.htm" tppabs="http://www.opensips.org/Documentation/TipsFAQ">Tips &amp; FAQ</a>
</li><li><a class='wikilink' title='Migration' href="Migration.htm" tppabs="http://www.opensips.org/Documentation/Migration">Version Migration</a>
</li><li><a class='wikilink' title='Webinars' href="Webinars.htm" tppabs="http://www.opensips.org/Documentation/Webinars">OpenSIPS Webinars</a>
</li><li><a class='wikilink' title='Troubleshooting' href="Troubleshooting.htm" tppabs="http://www.opensips.org/Documentation/Troubleshooting">Troubleshooting</a>
</li><li><a class='wikilink' title='Tools' href="Tools.htm" tppabs="http://www.opensips.org/Documentation/Tools">OpenSIPS Tools</a>
</li><li><a class='wikilink' title='Development-Tutorials' href="Development-Tutorials.htm" tppabs="http://www.opensips.org/Documentation/Development-Tutorials">Devel Tutorial</a>
</li></ul><div class='vspace'></div>
</td>
<!--/PageLeftFmt-->
      <td id='wikibody' valign='top'>
<!--PageTitleFmt-->
        
<!--PageText-->
<div id='wikitext'>
<h2 class='wikiaction'>Documentation.Tutorials-LoadBalancing History</h2>
  <p><a href="Tutorials-LoadBalancing-action=diff&source=y&minor=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=diff&source=y&minor=y">Show minor edits</a> - <a href="Tutorials-LoadBalancing-action=diff&source=n&minor=n.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=diff&source=n&minor=n">Show changes to output</a></p>
  <div id='wikidiff'>
      <div class='diffbox'><div class='difftime'>December 29, 2014, at 10:34 AM 
        by <span class='diffauthor' title='202.174.93.4'>lkumar</span> - Comment added</div>
        <div class='difftype'>Added lines 966-972:</div>
        <div class='diffadd'><div class='diffmarkup'>&gt;&gt;&lt;&lt;<br /><br />[[#comment65]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~lkumar]]  &amp;mdash;  [-29 December 2014, 10:34-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Is it possible to use the load balancer for failover to maintain a call dialog? In other words load_balance() an initial INVITE to one server and when that server goes down and a BYE comes into opensips from the user agent, lb_disable() that dead server and route the BYE to another server with the same call dialog using failure_route?<br />any help for same will be appropriated </div></div></div>
      <div class='diffrestore'><a href="Tutorials-LoadBalancing-action=edit&restore=diff-1419845679-1418790313-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1419845679:1418790313:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>December 17, 2014, at 05:25 AM 
        by <span class='diffauthor' title='27.118.30.2'>thiendv</span> - Comment added</div>
        <div class='difftype'>Added lines 960-965:</div>
        <div class='diffadd'><div class='diffmarkup'>&gt;&gt;&lt;&lt;<br /><br />[[#comment64]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~thiendv]]  &amp;mdash;  [-17 December 2014, 05:25-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi, i want to know, how many maximum concurrent call handled by Opensip if the media resource server is unlimited?</div></div></div>
      <div class='diffrestore'><a href="Tutorials-LoadBalancing-action=edit&restore=diff-1418790313-1410901756-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1418790313:1410901756:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>September 16, 2014, at 11:09 PM 
        by <span class='diffauthor' title='81.84.66.172'>SCC</span> - Comment added</div>
        <div class='difftype'>Added lines 944-959:</div>
        <div class='diffadd'><div class='diffmarkup'>&gt;&gt;&lt;&lt;<br /><br />[[#comment63]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~SCC]]  &amp;mdash;  [-16 September 2014, 23:09-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi,<br />the load balancing module seems very complete. One thing that i cannot find anywhere is how to load balance between opensips servers. For example, suppose there is no NAT between telco, Opensips servers and Asterisk servers (they're all on the same network). At the moment there exists,say 20 Asterisk servers for 3 Opensips (failover for me should always have a pair of servers + 1, reducing failover probability to 33%). Both OpenSips do load balance SIP calls to Asterisk servers and know exactly what each server can handle (say 2.000 simultaneous calls per server, total of 40.000 calls). In this concept, only 1 Opensips server handles the calls (Master), the second is Slave (listenning for any Master's failure) and the third Opensips server handles failover of Slave server. All Opensips share the same configuration DB and rules (get a SIP request, route to Asterisk, pass media from Asterisk to Telco directly for example).<br /><br />Now, say, we need to had 10 more Asterisk servers and need to add one more Opensips server to the network.<br />We would like then to set a Master+Master configuration, a Slave to failover one master and the forth server to failover the slave or a master.<br />Knowing this, a Master+Master configuration should receive calls all the time, meaning both Opensips Master Server will be live, thus, receiving SIP requests and routing requests to Asterisk boxes (we now have 30 call toasters).<br />Question is : we know that 1 Opensips can load balance calls to each one of the Asterisk boxes. If we had another Opensips, how will be load balancing handled? Do both Master Opensips server know exactly the load of each Asterisk servers? Can each Master know what each one of them is processing (Master A knows that Master B is processing 5.000 cps and is load balancing those calls for each available Asterisk)<br /><br />Thanks in advance<br /><br />SCC</div></div></div>
      <div class='diffrestore'><a href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1410901756:1403686775:&preview=y  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1410901756:1403686775:&preview=y%27" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1410901756:1403686775:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>June 25, 2014, at 10:59 AM 
        by <span class='diffauthor' title='89.120.101.121'>89.120.101.121</span> - </div>
        <div class='difftype'>Changed line 943 from:</div>
        <div class='diffdel'><div class='diffmarkup'></div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>%blue%[bogdan] - take a look at the &quot;load&quot; class statistics - http://www.opensips.org/Documentation/Interface-CoreStatistics-1-11 .%%</div></div></div>
      <div class='diffrestore'><a href="Tutorials-LoadBalancing-action=edit&restore=diff-1403686775-1403539245-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1403686775:1403539245:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>June 23, 2014, at 06:00 PM 
        by <span class='diffauthor' title='148.87.67.202'>mokbat</span> - Comment added</div>
        <div class='difftype'>Added lines 932-943:</div>
        <div class='diffadd'><div class='diffmarkup'>&gt;&gt;&lt;&lt;<br /><br />[[#comment62]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~mokbat]]  &amp;mdash;  [-23 June 2014, 18:00-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Bogdan,<br /><br />Is there any way to say that opensips is loaded and will not process any requests any more? Any place where I could add a custom message to say Opensips will not handle more calls. I am running into a situation where opensips is not responding to the BYE that is being sent by the UA via a proxy. I am trying to test hairpin scenario.<br /><br />Thanks for the wonderful tool and help.<br /><br /></div></div></div>
      <div class='diffrestore'><a href="Tutorials-LoadBalancing-action=edit&restore=diff-1403539245-1389174735-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1403539245:1389174735:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>January 08, 2014, at 10:52 AM 
        by <span class='diffauthor' title='59.103.76.82'>BFSP</span> - Comment added</div>
        <div class='difftype'>Added lines 926-931:</div>
        <div class='diffadd'><div class='diffmarkup'>&gt;&gt;&lt;&lt;<br /><br />[[#comment61]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~BFSP]]  &amp;mdash;  [-08 January 2014, 10:52-]  <br />&gt;&gt;messageitem&lt;&lt;<br />how i can use load balance on User registration ?? </div></div></div>
      <div class='diffrestore'><a href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1389174735:1368720177:&preview=y  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1389174735:1368720177:&preview=y%27" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1389174735:1368720177:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>May 16, 2013, at 06:02 PM 
        by <span class='diffauthor' title='109.99.235.212'>109.99.235.212</span> - </div>
        <div class='difftype'>Changed line 1 from:</div>
        <div class='diffdel'><div class='diffmarkup'>!![[Documentation.Index | Documentation]] -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; [[Documentation.Tutorials-LoadBalancing |  Load Balancing]]</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>!!!!!Documentation -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; Load Balancing</div></div></div>
      <div class='diffrestore'><a href="Tutorials-LoadBalancing-action=edit&restore=diff-1368720177-1368107475-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1368720177:1368107475:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>May 09, 2013, at 03:51 PM 
        by <span class='diffauthor' title='79.118.227.150'>79.118.227.150</span> - </div>
        <div class='difftype'>Changed lines 1-2 from:</div>
        <div class='diffdel'><div class='diffmarkup'>!!Resources -&gt; [[Resources.Documentation | Documentation]] -&gt; [[Resources.DocsTutorials | Tutorials]] -&gt; Load Balancing</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>!![[Documentation.Index | Documentation]] -&gt; [[Documentation.Tutorials | Tutorials ]] -&gt; [[Documentation.Tutorials-LoadBalancing |  Load Balancing]]<br />----</div></div>
        <div class='difftype'>Changed line 928 from:</div>
        <div class='diffdel'><div class='diffmarkup'>(:commentboxchrono:)</div></div>
        <div class='difftype'>to:</div>
        <div class='diffadd'><div class='diffmarkup'>(:commentboxchrono:)</div></div></div>
      <div class='diffrestore'><a href="Tutorials-LoadBalancing-action=edit&restore=diff-1368107475-1366822745-&preview=y.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1368107475:1366822745:&preview=y">Restore</a></div>
      <div class='diffbox'><div class='difftime'>April 24, 2013, at 06:59 PM 
        by <span class='diffauthor' title='213.233.101.41'>213.233.101.41</span> - </div>
        <div class='difftype'>Added lines 1-927:</div>
        <div class='diffadd'><div class='diffmarkup'>!!Resources -&gt; [[Resources.Documentation | Documentation]] -&gt; [[Resources.DocsTutorials | Tutorials]] -&gt; Load Balancing<br />This page has been visited {$PageCount} times.<br />(:toc-float Table of Content:)<br />----<br /><br />This tutorial applies for OpenSIPS versions 1.5, 1.6, 1.7 .<br /><br />!!! Load Balancing in '''OpenSIPS'''<br /><br />The &quot;load-balancing&quot; module comes to provide traffic routing based on load. Shortly, when '''OpenSIPS''' routes calls to a set of destinations, it is able to keep the load status (as number of ongoing calls) of each destination and to choose to route to the less loaded destination (at that moment).<br />'''OpenSIPS''' is aware of the capacity of each destination - it is preconfigured with the maximum load accepted by the destinations. To be more precise, when routing, '''OpenSIPS''' will consider the less loaded destination not the destination with the smallest number of ongoing calls, but the destination with the largest available slot.<br /><br />Also, the &quot;load-balancing&quot; (LB) module is able to receive feedback from the destinations (if they are capable of). This mechanism is used for notifying '''OpenSIPS''' when the maximum capacity of a destination changed (like a GW with more or less E1 cards).<br /><br />The &quot;load-balancing&quot; functionality comes to enhance the &quot;dispatcher&quot; one. The difference comes in having or not load information about the destinations where you are routing to:<br /><br />* '''Dispatcher has no load information''' - it just blindly forwards calls to the destinations based on a probabilistic dispersion logic. It gets no feedback about the load of the destination (like how many calls that were sent actually were established or how many are still going).<br /><br />* '''Load-balancer is load driven''' - LB routing logic is based primary on the load information. The LB module is using the DIALOG module in order to keep trace of the load (ongoing calls).<br /><br />%blue%[[http://www.amoocon.de/talks/8|A Workshop on this topic]] was held at Amoocon (former AsteriskTag) in Rostock, 4-5 May 2009%%<br /><br /><br />----<br />!!! Load Balancing - how it works<br /><br />When looking at the LB implementation in '''OpenSIPS''', we have 3 aspects:<br /><br />!!!! Destination set<br /><br />A destination is defined by its address (a SIP URI) and its description as capacity.<br /><br />Form the LB module perspective, the '''destinations are not homogeneous''' - they are not alike; and not only from capacity point of view, but also from what kind of '''services/resources''' they offer. For example, you may have a set of Yate/Asterisk boxes for media-related services -some of them are doing transcoding, other voicemail or conference,  other simple announcement , other PSTN termination. But you may have mixed boxes - one box may do PSTN and voicemail in the same time. So each destination from the set may offer a different set of services/resources.<br /><br />So, for each destination, the LB module defines the offered resources, and for each resource, it defines the '''capacity / maximum load''' as number of concurrent calls the destination can handle for that resource.<br /><br />Example:<br />[@<br />4 destinations/boxes in the LB set<br />    1) offers 30 channels for transcoding and 32 for PSTN<br />    2) offers 100 voicemail channels and 10 for transcoding<br />    3) offers 50 voicemail channels and 300 for conference<br />    4) offers 10 voicemail, 10 conference, 10 transcoding and 32 PSTN<br /><br />This translated into the following setup:<br /><br />+----+----------+------------------------+---------------------------------+<br />| id | group_id | dst_uri                | resources                       |<br />+----+----------+------------------------+---------------------------------+<br />|  1 |        1 | sip:yate1.mycluset.net | transc=30; pstn=32              |<br />|  2 |        1 | sip:yate2.mycluset.net | vm=100; transc=10               |<br />|  3 |        1 | sip:yate3.mycluset.net | vm=50; conf=300                 |<br />|  4 |        1 | sip:yate4.mycluset.net | vm=10;conf=10;transc=10;pstn=32 |<br />+----+----------+------------------------+---------------------------------+<br /><br />@]<br /><br />For runtime, the LB module provides MI commands for:<br />* reloading the definition of destination sets<br />* changing the capacity for a resource for a destination<br /><br />!!!! Invoking Load-balancing<br /><br />Using the LB functionality is very simple - you just have to pass to the LB module what kind of resources the call requires.<br /><br />The resource detection is done in the '''OpenSIPS''' routing script, based on whatever information is appropriated. For example, looking at the RURI (dialed number) you can see if the call must go to PSTN or if it a voicemail or conference number; also, by looking at the codecs advertised in the SDP, you can figure out if transcoding is or not also required.<br /><br />[@<br /><br />  if (!load_balance(&quot;1&quot;,&quot;transc;pstn&quot;)) {<br />      sl_send_reply(&quot;500&quot;,&quot;Service full&quot;);<br />      exit;<br />  }<br /><br />@]<br /><br />The first parameter of the function identifies the LB set to be used (see the group_id column in the above DB snapshot). Second parameter is list of the required resource for the call.<br /><br />The '''load_balance()''' will automatically create the dialog state for the call (in order to monitor it) and will also allocate the requested resources for it (from the selected box).\\<br />The function will set as destination URI ($du) the address of the selected destination/box.<br /><br />The resources will be automatically released when the call terminates. <br /><br />The LB module provides an MI function that allows the admin to inspect the current load over the destinations.<br /><br /><br />!!!! The LB logic<br /><br />The logic used by the LB module to select the destination is:<br /># gets the '''destination set based on the group_id''' (first parameter of the ''load_balance()'' function)<br /><br /># selects from the set only the '''destinations that are able to provide the requested resources''' (second parameter of the ''load_balance()'' function)<br /><br /># for the selected destinations, it '''evaluated the current load''' for each requested resource<br /><br /># the winning destination is the one with '''the biggest value for the minimum available load''' per resources.<br /><br />[@<br />Example:<br /><br />4 destinations/boxes in the LB set<br />    1) offers 30 channels for transcoding and 32 for PSTN<br />    2) offers 100 voicemail channels and 10 for transcoding<br />    3) offers 50 voicemail channels and 300 for conference<br />    4) offers 10 voicemail, 10 conference, 10 transcoding and 32 PSTN<br /><br />when calling load_balance(&quot;1&quot;,&quot;transc;pstn&quot;) -&gt;<br /><br />1) only boxes (1) and (4) will be selected at as they offer both transcoding and pstn<br /><br />2) evaluating the load  :<br />    (1) transcoding - 10 channels used; PSTN - 18 used <br />    (4) transcoding - 9 channels used; PSTN - 16 used <br /><br />   evaluating available load (capacity-load) :<br />    (1) transcoding - 20 channels used; PSTN - 14 used <br />    (4) transcoding - 1 channels used; PSTN - 16 used <br /><br />3) for each box, the minimum available load (through all resources)<br />    (1) 14 (PSTN)<br />    (2) 1 (transcoding) <br /><br />4) final selected box in (1) as it has the the biggest (=14) available load for the most loaded resource.<br /><br />@]<br /><br />The selection algorithm tries to avoid the intensive usage of a resource per box.<br /><br /><br />----<br />!!! Study Case: routing the media gateways<br /><br /><br />Here is the full configuration and script for performing LB between media peers.<br /><br />!!!! Configuration<br /><br />Let's consider the case previously described:<br /><br />[@<br />4 destinations/boxes in the LB set<br />    1) offers 30 channels for transcoding and 32 for PSTN<br />    2) offers 100 voicemail channels and 10 for transcoding<br />    3) offers 50 voicemail channels and 300 for conference<br />    4) offers 10 voicemail, 10 conference, 10 transcoding and 32 PSTN<br /><br />This translated into the following setup:<br /><br />+----+----------+------------------------+---------------------------------+<br />| id | group_id | dst_uri                | resources                       |<br />+----+----------+------------------------+---------------------------------+<br />|  1 |        1 | sip:yate1.mycluset.net | transc=30; pstn=32              |<br />|  2 |        1 | sip:yate2.mycluset.net | vm=100; transc=10               |<br />|  3 |        1 | sip:yate3.mycluset.net | vm=50; conf=300                 |<br />|  4 |        1 | sip:yate4.mycluset.net | vm=10;conf=10;transc=10;pstn=32 |<br />+----+----------+------------------------+---------------------------------+<br /><br />@]<br /><br /><br />!!!! OpenSIPS Scripting <br /><br /><br />[@<br />debug=1<br />memlog=1<br /><br />fork=yes<br />children=2<br />log_stderror=no<br />log_facility=LOG_LOCAL0<br /><br />disable_tcp=yes<br />disable_dns_blacklist = yes<br /><br />auto_aliases=no<br /><br />check_via=no<br />dns=off<br />rev_dns=off<br /><br />listen=udp:xxx.xxx.xxx.xxx:5060<br /><br /><br /><br />loadmodule &quot;modules/maxfwd/maxfwd.so&quot;<br />loadmodule &quot;modules/sl/sl.so&quot;<br />loadmodule &quot;modules/db_mysql/db_mysql.so&quot;<br />loadmodule &quot;modules/tm/tm.so&quot;<br />loadmodule &quot;modules/xlog/xlog.so&quot;<br />loadmodule &quot;modules/uri/uri.so&quot;<br />loadmodule &quot;modules/rr/rr.so&quot;<br />loadmodule &quot;modules/dialog/dialog.so&quot;<br />loadmodule &quot;modules/mi_fifo/mi_fifo.so&quot;<br />loadmodule &quot;modules/mi_xmlrpc/mi_xmlrpc.so&quot;<br />loadmodule &quot;modules/signaling/signaling.so&quot;<br />loadmodule &quot;modules/textops/textops.so&quot;<br />loadmodule &quot;modules/load_balancer/load_balancer.so&quot;<br /><br /><br /><br />modparam(&quot;mi_fifo&quot;, &quot;fifo_name&quot;, &quot;/tmp/opensips_fifo&quot;)<br /><br />modparam(&quot;dialog&quot;, &quot;dlg_flag&quot;, 13)<br />modparam(&quot;dialog&quot;, &quot;db_mode&quot;, 1)<br />modparam(&quot;dialog&quot;, &quot;db_url&quot;, &quot;mysql://opensips:opensipsrw@localhost/opensips&quot;)<br /><br />modparam(&quot;rr&quot;,&quot;enable_double_rr&quot;,1)<br />modparam(&quot;rr&quot;,&quot;append_fromtag&quot;,1)<br /><br />modparam(&quot;load_balancer&quot;, &quot;db_url&quot;,&quot;mysql://opensips:opensipsrw@localhost/opensips&quot;)<br /><br /><br />route{<br />	if (!mf_process_maxfwd_header(&quot;3&quot;)) {<br />		sl_send_reply(&quot;483&quot;,&quot;looping&quot;);<br />		exit;<br />	}<br /><br /><br />	if (!has_totag()) {<br />                # initial request<br />		record_route();<br />	} else {<br />		# sequential request -&gt; obey Route indication<br />		loose_route();<br />                t_relay();<br />                exit;<br />        }<br /><br />        # handle cancel and re-transmissions<br />	if ( is_method(&quot;CANCEL&quot;) ) {<br />		if ( t_check_trans() )<br />			t_relay();<br />		exit;<br />	}<br /><br /><br />        # from now on we have only the initial requests<br />        if (!is_method(&quot;INVITE&quot;)) {<br />                send_reply(&quot;405&quot;,&quot;Method Not Allowed&quot;);<br />                exit;<br />        }<br /><br />        # detect resources and do balancing<br />        if ($rU=~&quot;^1&quot;) {<br />                # looks like a Conference call<br />                load_balance(&quot;1&quot;,&quot;conf&quot;);<br />        } else if ($rU=~&quot;^2&quot;) {<br />                # looks like a VoiceMail call<br />                load_balance(&quot;1&quot;,&quot;vm&quot;);<br />        } else {<br />                # PSTN call, but the GWs supports only G711<br />                # for calls without G711, transcoding will be used on the GW<br />                if ( !search_body(&quot;G711&quot;) ) {<br />                       load_balance(&quot;1&quot;,&quot;transc;pstn&quot;);<br />                } else {<br />                       load_balance(&quot;1&quot;,&quot;pstn&quot;);<br />                }<br />        }<br /><br />        # LB function returns negative if no suitable destination (for requested resources) is found,<br />        # or if all destinations are full<br />        if ($retcode&lt;0) {<br />             sl_send_reply(&quot;500&quot;,&quot;Service full&quot;);<br />             exit;<br />        }<br /><br />	xlog(&quot;Selected destination is: $du\n&quot;);<br /><br />        # send it out<br />	if (!t_relay()) {<br />		sl_reply_error();<br />	}<br />}<br /><br /><br />@]<br /><br /><br />----<br />!!! Comments<br /><br />[[#comment1]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Gavin]]  &amp;mdash;  [-15 March 2009, 23:41-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Does this have to use Yate? Can Asterisk or FreeSwitch be used?<br /><br />%blue%[bogdan] - there is no dependency (regarding the application you LB) - so you can have Yate, Asterisk, FreeSwitch, Cisco GW, Audiocodec GW, etc%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment3]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Ian C.]]  &amp;mdash;  [-20 March 2009, 02:41-]  <br />&gt;&gt;messageitem&lt;&lt;<br />This is nice and simple.  I am still learning OpenSIPs, but is it possible to combine this with a registrar function?  Looking how to combine Load Balancing to a few Asterisk servers with OpenSIP also performing the registration.<br /><br />%blue%[bogdan] - Of course it is possible - if you look at the default opensips cfg (that has the registrar capabilities), for processing the INVITE requests you can use load_balancing() function. If you have issues, use the mailing list for getting help%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment5]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~haidavila]]  &amp;mdash;  [-04 April 2009, 04:21-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi. I´ve installed the new version (1.5) and I'm using load_balancer module but I'm having a problem... When a SIP server goes down and if it had the best attributes, load_balancer keeps sending the calls to it and all my calls drop. Is this normal? Can Opensips notices that this server is not working and pass it to the next sip server?<br /><br />Thank you!<br /><br />%blue%[bogdan]- unfortunately in the current version (1.5) you can not disable from script a destination; but you can do it from outside, via MI command (lb_resize to 0); you can use exec() from script to run the opensipsctl and resize the 0 the guilty server. Hope it will help. - btw, we can do disable from script with 1.6 %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment7]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~haidavila]]  &amp;mdash;  [-11 April 2009, 03:21-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Thank you bogdan, it really helped me.<br /><br />Regards!<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment8]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~elred]]  &amp;mdash;  [-14 April 2009, 19:01-]  <br />&gt;&gt;messageitem&lt;&lt;<br />What if you have, let's say, 3 phones. You want each phone being able to contact each others. BUT, if you don't fall on the same server where the REGISTER was broadcasted, the PABX won't know the IP of the callee, and call won't be achieved.<br />Is there a way to bounce REGISTER to multiple PABX ?<br />Thanks !<br /><br />%blue%[bogdan] - I do not think this is a typical case of LB (as there is some relation between the PBX you balance). What you can do is to separately deal with REGISTER and fork it (from LB server, with no LB) to all PBX and to do do LB only for INVITEs. Just an idea%%<br />&gt;&gt;&lt;&lt;<br /><br /><br />[[#comment11]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~asterisktech]]  &amp;mdash;  [-21 April 2009, 14:25-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi,<br /><br />I also would appreciate if someone could post here a howto of integration of opensips with asterisk.<br /><br />asterisktech<br /><br />%blue%[bogdan] - what kind of &quot;integration&quot; you have in mind? I mean what opensips to do and what asterisk to do.%%<br />&gt;&gt;&lt;&lt;<br /><br /><br />[[#comment13]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~geejee]]  &amp;mdash;  [-10 May 2009, 10:35-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi,<br /><br />what I like to do is to connect more than one client (e.g. desktop phone and soft phone) to one asterisk sip account. Asterisk cannot handle this because only one client can register.<br />So opensips should work as sort of client inbetween. Username/password verification should be done by Asterisk.<br />Does anyone know how to do this and give me a sample configuration for opensips?<br /><br />Thanks<br /><br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment14]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~sriram]]  &amp;mdash;  [-09 June 2009, 18:15-]  <br />&gt;&gt;messageitem&lt;&lt;<br />HI,<br /><br />I am load balancing the calls between gateways with different port values. Say I have total of 15 ports, the load balance modules works fine till 15th call. At 16th call load balance fails(this is the only call made,means all 15 ports are free ) and I am not getting calls on the gateway if I don't issue lb_reload command.  <br />I would appreciate if someone could let me know any other method to call get the current load status automatically set without entering the lb_reload comman statement.<br /><br />thanks<br /><br />%blue%[bogdan] - upgrade from svn to the latest version and if you still have issue, pleas post on the users mailing list %%<br />&gt;&gt;&lt;&lt;<br /><br /><br />[[#comment15]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Javier]]  &amp;mdash;  [-31 July 2009, 02:25-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi,<br /><br />I'm getting the error:<br />ERROR:core:yyparse: module 'mi_xmlrpc.so' not found in '/usr/local/lib/opensips/modules/'<br />all the time whenever I try to use the load_balancer module. <br />This is something I got since 1.5.1 and thought was a bug in that version and used dispatcher instead.<br />Today, I made a fresh install of opensips 1.5.2 over a Centos 5.1 and got the same error.<br />Could somebody point me in the right direction to solve this problem ?<br /><br />thanks!<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment16]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~vaitek]]  &amp;mdash;  [-01 August 2009, 10:17-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hello Bogdan,<br />Great work... what if one of balanced server has ended the call in case of the limit call time ? - OpenSIPS doesn't release resources as I realised... - how can I tell LB module that it should release resources? Is there any way to shere information about resources between LB and VOIP(switches,gateways,etc) ?<br /><br />%blue%[bogdan] - if the call is release properly (from signalling point of view, with a BYE) the LB will see the call as terminated and release the resources.%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment17]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~plimaye]]  &amp;mdash;  [-02 August 2009, 20:33-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Javier,<br /><br />You need to uncomment mi_xmlrpc in Makefile to compile the module , but you will require xmlrpc-c and xmlrpc-c-devel installed ( I am using xmlrpc-c-1.16.6-1.1582 on Centos 5.3) to compile 1.5.2. So far its working but its not supported. Will update this if I find issues with xmlrpc-c version.<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment18]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Javier]]  &amp;mdash;  [-04 August 2009, 17:40-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Plimaye, Thank you very much for your help.<br />I did that and certainly, it was in the exclude modules at makefile. I commented it.<br />After that, I ran make clean, make and make install again and compiled ok (no errors) but I can't find xmlrpc-c and xmlrpc-c-devel to install.<br /><br />and every time I try to run opensips, I get: <br /><br />ERROR:core:sr_load_module: could not open module &amp;lt;mi_xmlrpc.so&amp;gt;: mi_xmlrpc.so: cannot open shared object file: No such file or directory<br /><br />and really mi_xmlrpc.so is there in the modules folder!!!<br /><br />If you have any other suggestion, please let me know.<br /><br />Thanks a lot again!<br /><br />%blue%[bogdan] - check if your cfg file is pointing to the right directory for loading the modules%%<br /><br />&gt;&gt;&lt;&lt;<br /><br /><br />[[#comment20]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Alp]]  &amp;mdash;  [-06 August 2009, 16:49-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hello,<br />I am getting this error while initializing LB module. I couldnt find anything wrong why its getting me this error.<br /><br />Aug  6 17:44:49 ubuntu /sbin/opensips[7696]: INFO:load_balancer:mod_init: Load-Balancer module - initializing <br />Aug  6 17:44:49 ubuntu /sbin/opensips[7696]: ERROR:load_balancer:mod_init: Can't load dialog hooks<br />Aug  6 17:44:49 ubuntu /sbin/opensips[7696]: ERROR:core:init_mod: failed to initialize module load_balancer <br />Aug  6 17:44:49 ubuntu /sbin/opensips[7696]: ERROR:core:main: error while initializing modules <br /><br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment21]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Alp]]  &amp;mdash;  [-06 August 2009, 17:32-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I added module Dialog.so and add modparam(&quot;dialog&quot;, &quot;dlg_flag&quot;, 4) in opensips.cfg file and it works!!<br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment22]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Alp]]  &amp;mdash;  [-06 August 2009, 18:04-]  <br />&gt;&gt;messageitem&lt;&lt;<br />There is one more bracket ')' in line if (!search_body(&quot;G711&quot;) )) {. It gives error.<br /><br />%blue%[bogdan] - fixed, thank you %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment23]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~motto]]  &amp;mdash;  [-08 August 2009, 00:52-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hey,<br /> default load_balance configuration doesn't process &quot;ACK&quot; SIP packet from the Asterisk END, so the Asterisk after SIP ACK retransmiting several times hangup a call.<br /> Any idea on that ?<br /><br /><br />%blue%[bogdan] - the ACK (if properly formed by caller device) should contain the Route header and OpenSIPS will route it as sequential request (via loose_route() )%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment24]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~ravi]]  &amp;mdash;  [-14 August 2009, 17:04-]  <br />&gt;&gt;messageitem&lt;&lt;<br />is there anyway, loadbalancer can get destination ip address dynamically.<br />Ex: i have 3 asterisk servers to be load balanced but some time i want to upgrade one asterisk server that case i want to remove that asterisk server ip address from load balancer database is that possible?<br /><br />%blue%[bogdan] - update the IPs in DB and do via MI a &quot;lb_reload&quot; %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment25]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Javier]]  &amp;mdash;  [-18 August 2009, 15:24-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Bogdan,<br /><br />Thank you for your suggestion &quot;Javier, check if your cfg file is pointing to the right directory for loading the modules.&quot;<br />Really, the opensips.cfg is pointing properly to the modules directory.<br /><br />Any other suggestion ?<br /><br />Thank you, <br /><br />Javier.<br /><br />%blue%[bogdan] - check if the  mi_xmlrpc.so file really exists in the directory you configured %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment26]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Ricardo]]  &amp;mdash;  [-18 August 2009, 20:27-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Bogdan.<br />Is possible to mix the load_balancer module with the LCR module?... i need the features from the LCR to route the calls, but also i need to know the status of a GW with E1/T1 and balance the load between several Gw's.<br />Is this possible?<br />Thanks<br /><br />Ricardo.-<br /><br />%blue%[bogdan] - that is a bit tricky as you have two engines for doing routing (but on different criteria) DR - prefix routing, LB - load routing; only if you chain them, like first DR to select a set of GWs(per prefix) and after that LB to choose one of the GWs from the DR set%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment27]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~ravi]]  &amp;mdash;  [-26 August 2009, 17:47-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Bogdan, is possible to assign variable in load_balance(&quot;$var(a0)&quot;,&quot;vm&quot;) or load_balance(&quot;$avp(i:55)&quot;,&quot;vm&quot;) function?<br /><br />Ravi<br /><br /><br />%blue%[bogdan] - starting with 1.6 yes %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment28]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Raj]]  &amp;mdash;  [-30 October 2009, 10:14-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Bogdam, I am using OpenSIPSv1.5.3 on centOS. If I load load_balancer.so the server start is failed.<br />loadmodule &quot;modules/load_balancer/load_balancer.so&quot;<br />modparam(&quot;load_balancer&quot;, &quot;db_url&quot;,&quot;mysql://opensips:opensipsw@localhost/opensips&quot;), I have created opensips user and password in db. Please suggest me with a solution if possible.<br /><br />Raj<br /><br />%blue%[bogdan] - see http://www.opensips.org/Resources/DocsTsStart ; it must be an error reported %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment29]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~JG]]  &amp;mdash;  [-12 November 2009, 21:41-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I just installed OpenSips but i just don't understand the configuration part for the LB, i just want to do something like this:<br /><br />prefix 044<br />redirect to ZAP Channel 37 and ZAP Channel 38<br /><br />One call to 37 and the next to 38 and if both are busy to the default unicall<br /><br />Can you guys help me out...<br /><br />Thanks in advanced<br /><br />JG<br /><br />%blue%[bogdan] - post your question on the user mailing list %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment23]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~LouisFox]]  &amp;mdash;  [-11 March 2010, 09:10-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I have a PSTN VoIP Gateway that is sending and receiving VoIP SIP calls to a SIP Gateway on the internet. I have 3 WAN connections. Can I use the load balancer to do call load balancing between the VoIP Gateway and the SIP Proxy. Can the load balancer distribute the VoIP load between the 3 connections equally and then also to receive and forward calls from the SIP Gateway to the VoIP PSTN Gateway. <br />It is a single Internet SIP Proxy Service.  8 Calls per link<br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment24]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Senthil.O]]  &amp;mdash;  [-16 July 2010, 19:49-]  <br />&gt;&gt;messageitem&lt;&lt;<br />is there a way to load balance based on calls per second (CPS) instead of total concurrent call? i have two sip carrier with 50 cps each and my auto dealers are dialing @ 60 calls per second.<br /><br />%blue%[bogdan] - no, it is not possible %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment25]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Anh Ha]]  &amp;mdash;  [-22 July 2010, 08:43-]  <br />&gt;&gt;messageitem&lt;&lt;<br />In the Load_balancer tables : <br /><br /> 4  	 2  	 sip:192.168.1.1  	 pstn=300  	 0  	 VNP #1<br />-------------<br />In opensips.cfg:<br /><br />if    (uri=~&quot;^sip:.....9[0-2]*@&quot;)<br />     {<br />   xlog(&quot;route to Vinaphone&quot;);<br />          load_balance(&quot;2&quot;,&quot;pstn&quot;);<br />        # route(4);<br />     }<br /><br />---------------------<br />when i call 99984917xxxx , it matches the condition but it doesn't route the call to 192.168.1.1<br />If i have &quot;route(4);&quot; bellow &quot;load_balance(&quot;2&quot;,&quot;pstn&quot;);&quot;, then it routes follow route(4)<br /><br />Please help me<br />Tks<br /><br />%blue%[bogdan] - post your question on the user mailing list %%<br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment26]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~h3xd]]  &amp;mdash;  [-22 September 2010, 05:21-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Can the LB be used to balance between multiple NAT traversal systems?<br /><br />%blue%[bogdan] - no, as a nat traversal system must be directly linked to the nated entity, so adding a LB between NAT traversal system and nated entity will break the NAT visibility at network level %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment27]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~opensipnewbie]]  &amp;mdash;  [-29 September 2010, 11:45-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Is it possible to load balance in stateless mode?<br /><br />%blue%[bogdan] - not with LB module (as the load is the number of calls, it must be dialog stateful) ; for stateless approaches, see the dispatcher module %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment28]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~merik]]  &amp;mdash;  [-19 October 2010, 16:38-]  <br />&gt;&gt;messageitem&lt;&lt;<br />it's very hard for me to configure opensips with module load_balance .someone have a good tutorial or a typical config of opensip.cfg to load_balance 3 asterisk<br /><br />%blue%[bogdan] - if this tutorial (which will cover your case) does not help you, use the mailing lists %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment29]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~elwan]]  &amp;mdash;  [-08 December 2010, 23:31-]  <br />&gt;&gt;messageitem&lt;&lt;<br />its work with me but sometime i got no sound :(<br />and also i see the opensips ip not the user ip<br />what it's  worng ??<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment30]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~dcola]]  &amp;mdash;  [-06 January 2011, 23:23-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Is it possible to use the load balancer for failover to maintain a call dialog? In other words load_balance() an initial INVITE to one server and when that server goes down and a BYE comes into opensips from the user agent, lb_disable() that dead server and route the BYE to another server with the same call dialog using failure_route?<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment31]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Mesha]]  &amp;mdash;  [-19 January 2011, 13:07-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Registered OpenSIPS user. Incoming call on registered any softphone = everything ok.<br />Registered OpenSIPS user. Incoming call on registered any hardphone (Grandstream (handytone,GXVxxx), matrix, hanglong) = no audio both ways??? Problem!!! What can be a solution?<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment32]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~chaithu1987]]  &amp;mdash;  [-17 March 2011, 22:11-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I am new to opensips,can any one give me some idea which version of opensips to use for sip dialog(invite---100 trying----bye) and registration.<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment33]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~jarce]]  &amp;mdash;  [-07 April 2011, 22:11-]  <br />&gt;&gt;messageitem&lt;&lt;<br />???<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment34]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~jarce]]  &amp;mdash;  [-07 April 2011, 22:15-]  <br />&gt;&gt;messageitem&lt;&lt;<br />hello, there are forums in Spanish on this site?<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment35]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~ThienVo]]  &amp;mdash;  [-26 April 2011, 16:23-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi sir Bongdan<br />I have this problem,please help me.<br />I use LB for 2 asterisk gateway.But when call terminal BYE package throught direct from asterisk to user not throught opensips.So resources can't release and finally after any call opensips notify serveice full untill i restart opensips.How to make opensips receive BYE package to release resources.<br />Thanks alot<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment36]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~sd]]  &amp;mdash;  [-23 June 2011, 12:11-]  <br />&gt;&gt;messageitem&lt;&lt;<br />sd<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment37]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Sanjeev]]  &amp;mdash;  [-23 June 2011, 12:22-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Sir, <br /><br />i wanted to setup loadblanacer, i am using two server for load balancing, 10.0.3.30 &amp;amp; 10.0.12.75,<br />in live scenario 400 calls will come, i want 200 calls on 10.0.3.30 server and 200 calls 10.0.12.75 server, i have installed openser on 10.0.1.138 server now when i edit following lines then getting following error<br /><br />if (loose_route()) {<br />t_relay();<br />};<br />ds_select_dst(&quot;1&quot;, &quot;0&quot;);<br />record_route();<br />t_relay();<br />Jun 22 16:10:18 Testing openser: parse error (101,1-2): syntax error <br />Jun 22 16:10:18 Testing openser: parse error (101,1-2):  <br /><br />Error<br />Jun 22 16:10:18 Testing openser: INFO:mi_fifo:mi_destroy:memory for the child's mi_fifo_pid was not allocated -&amp;gt; nothing to destroy <br />Jun 22 16:10:30 Testing openser: parse error (101,1-2): syntax error <br />Jun 22 16:10:30 Testing openser: parse error (101,1-2):  <br />Jun 22 16:10:30 Testing openser: INFO:mi_fifo:mi_destroy:memory for the child's mi_fifo_pid was not allocated -&amp;gt;<br /> <br />Can you please share sample file with below configuration or let me know how i can achive this<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment38]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Sanjeev]]  &amp;mdash;  [-24 June 2011, 06:47-]  <br />&gt;&gt;messageitem&lt;&lt;<br />do i have to register UA client with OpenSER for using LoadBalancing Feature?<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment39]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Khainou]]  &amp;mdash;  [-04 August 2011, 13:52-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I set up this feature, but the number of &quot;load&quot; in opensipsctl lb_list fifo does not decrease.<br /><br />So, resources are always used. To reset, I have to restart.<br /><br />How can I do to make this work?<br /><br />Thank you!<br /><br /><br />Here is my configuration file:<br /><br />route{<br /><br /> if ($rU==&quot;dialog&quot;) {<br />                xlog(&quot;L_INFO&quot;,&quot;---------dialog---------&quot;);<br />                if (load_balance(&quot;1&quot;,&quot;dialog&quot;))<br />                        route(1);<br />                else<br />                        route(2);<br />        }<br />        else {<br />                xlog(&quot;L_INFO&quot;,&quot;---------conf---------&quot;);<br />                if (load_balance(&quot;1&quot;,&quot;conf&quot;))<br />                        route(1);<br />                else<br />                        route(2);<br />        }<br />}<br />route[1] {<br />        xlog(&quot;l'appel est dirige vers :  $dun&quot;);<br />        t_relay();<br />        exit();<br />}<br /><br />route[2] {<br />        xlog(&quot; ---- Service Full ---- &quot;);<br />        sl_send_reply(&quot;500&quot;,&quot;Service full&quot;);<br />        exit();<br />}<br /><br /><br />And lb_list :<br />Destination:: sip:X.X.X.X:5060 id=1 group=1 enabled=yes auto-re=on<br />        Resource:: dialog max=2 load=0<br />Destination:: sip:X.X.X.X:5060 id=1 group=1 enabled=yes auto-re=on<br />        Resource:: dialog max=2 load=0<br />Destination:: sip:X.X.X.X:5060 id=2 group=1 enabled=yes auto-re=on<br />        Resource:: conf max=2 load=0<br />Destination:: sip:X.X.X.X:5060 id=2 group=1 enabled=yes auto-re=on<br />        Resource:: conf max=2 load=0<br /><br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment40]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Khainou]]  &amp;mdash;  [-04 August 2011, 15:14-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Thanks to the forum, I solved the problem!<br /><br />;)<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment41]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Suman Singh Rana]]  &amp;mdash;  [-02 December 2011, 12:31-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Can we run OpenSip 1.6.4 run on 64 bit linux machine (x86_64 GNU/Linux. <br /><br />I am using opensips-1.6.4-2-notls_src.tar  right on 32bit Linux machine ( i386 GNU/Linux )<br /><br />%blue%[bogdan] - yes, you can %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment42]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Allen Ford]]  &amp;mdash;  [-06 December 2011, 22:17-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Im getting error :<br /><br />Dec  6 15:58:04 c-24-30-48-18 /sbin/opensips[25235]: ERROR:load_balancer:do_load_balance: unknown resource in input string<br /><br /><br />%blue%[bogdan] - this error means you ask for a resource (in load_balance() function), that does not appear in the definition of the peers/destinations %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment43]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Rana]]  &amp;mdash;  [-08 December 2011, 08:28-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Can we run OpenSip LB on 64 bit linux machine ?<br /><br />%blue%[bogdan] - yes, you can %%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment44]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Allen Ford]]  &amp;mdash;  [-09 December 2011, 14:56-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Im unable to recieve calls with this setup...   is there anyway we can intergrate nathelper and rtpproxy in here?  been trying too do it for 2 days<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment45]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Allen Ford]]  &amp;mdash;  [-11 December 2011, 21:31-]  <br />&gt;&gt;messageitem&lt;&lt;<br />i found my problem,    when 2 extensions call each other it goes to asterisk via the load balancer,  then asterisk sends it back since it shows registered via opensips...    im getting loop<br /><br /><br />%blue%[bogdan] - please do not post net traces here (because of size) - better use the &quot;users&quot; mailing list.%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment46]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Tim Burke]]  &amp;mdash;  [-11 January 2012, 19:25-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Is there any means of keeping two instances of OpenSIPS synchronized in terms of the current call count of a destination?  I'm wondering about the fault tolerance of losing one instance and having the other instance pick up the load balancing.  Or perhaps even active/active operation of multiple instances of OpenSIPS.<br /><br />%blue%[bogdan] - the possibility the exchange load information between multiple load-balancers will be available with 1.8 version (via distributed dialog profiles).%%<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment47]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Ionut Muntean]]  &amp;mdash;  [-25 April 2012, 14:12-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hello all! Need to do some simple, round-robin load balancing to a cluster of Yate servers, no load check, just take the calls and give them to the next Yate in the list. Is there a simple example for this somewhere?<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment48]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Tim Burke]]  &amp;mdash;  [-17 July 2012, 16:43-]  <br />&gt;&gt;messageitem&lt;&lt;<br />&quot;Also, the &quot;load-balancing&quot; (LB) module is able to receive feedback from the destinations (if they are capable of).&quot;<br /><br />Does anyone know more details about that?  Is this referring to updating and reloading the LB database?<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment49]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Pepper]]  &amp;mdash;  [-20 August 2012, 03:46-]  <br />&gt;&gt;messageitem&lt;&lt;<br />That really captures the spriit of it. Thanks for posting.<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment50]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Terje]]  &amp;mdash;  [-20 August 2012, 04:19-]  <br />&gt;&gt;messageitem&lt;&lt;<br />For xmpp to PSTN, you can simply use asertisk to convert jingle to sip, and then sip to anything you want, provided you have the proper hardware. I assume that others sip servers can do it  ( callweaver, opensip, etc ), since both sip, jingle and the regular telephone are standardized features.<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment51]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Jean]]  &amp;mdash;  [-20 August 2012, 13:33-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I managed to dig up those two files  I've only ineucdld the parts that you might need to change (I didn't include the entire file just the statements concerning the two IP phones I setup.You'll need to find their MAC address (on the back of the phone) and then depending on software version the phone is running you may need to tweak the rtp_method.unistim.conf[phone1]                     ; name of the devicedevice=001765ffe0fc         ; mac address of the phonertp_port=10000              ; RTP port used by the phone, default = 10000. RTCP = rtp_port+1rtp_method=3                ; If you don't have sound, you can try 1, 2 or 3, default = 0status_method=0             ; If you don't see status text, try 1, default = 0titledefault=Asterisk       ; default = &quot;TimeZone (your time zone)&quot;. 12 characters maxmaintext0=&quot;Asterisk PBX&quot;  ; default = &quot;Welcome&quot;, 24 characters max;maintext1=&quot;a custom text&quot;   ; default = the name of the device, 24 characters max;maintext2=&quot;(main page)&quot;     ; default = the public IP of the phone, 24 characters max;dateformat=1                ; 0 = month/day, 1 (default) = day/month;timeformat=1                ; 0 = 0:00am ; 1 (default) = 0h00, 2 = 0:00;contrast=8                  ; define the contrast of the LCD. From 0 to 15. Default = 8;country=us                  ; country (ccTLD) for dial tone frequency. See README, default = us;ringvolume=2                ; ring volume : 0,1,2,3, can be overrided by Dial(), default = 2ringstyle=3                 ; ring style : 0 to 7, can be overrided by Dial(), default = 3callhistory=1               ; 0 = disable, 1 = enable call history, default = 1callerid=&quot;Customer Support&quot; &amp;lt;555-234-5678&amp;gt;context=michael             ; context, default=&quot;default&quot;mailbox=2000                ; Specify the mailbox number. Used by Message Waiting Indication;linelabel=&quot;Support&quot;         ; Softkey label for the next line=&amp;gt; entry, 9 char max.;extension=line              ; Add an extension into the dialplan. Only valid in context specified previously.                             ; none=don't add (default), ask=prompt user, line=use the line numberline =&amp;gt; 100                 ; Only one line by device is currently supported.                             ; Beware ! only bookmark and softkey entries are allowed after line=&amp;gt;;bookmark=Hans C.@123        ; Use a softkey to dial 123. Name : 9 char max;bookmark=Mailbox@011@54     ; 54 shows a mailbox icon. See #define FAV_ICON_ for other values (32 to 63)bookmark=Test@*@USTM/phone2  ; Display an icon if violet is connected (dynamic), only for unistim device;bookmark=4@Pager@54321@51   ; Display a pager icon and dial 54321 when softkey 4 is pressed[phone2]                     ; name of the devicedevice=0018b0342c34         ; mac address of the phonertp_port=10000              ; RTP port used by the phone, default = 10000. RTCP = rtp_port+1rtp_method=3                ; If you don't have sound, you can try 1, 2 or 3, default = 0status_method=0             ; If you don't see status text, try 1, default = 0titledefault=Asterisk       ; default = &quot;TimeZone (your time zone)&quot;. 12 characters maxmaintext0=&quot;Asterisk PBX&quot;  ; default = &quot;Welcome&quot;, 24 characters max;maintext1=&quot;a custom text&quot;   ; default = the name of the device, 24 characters max;maintext2=&quot;(main page)&quot;     ; default = the public IP of the phone, 24 characters max;dateformat=1                ; 0 = month/day, 1 (default) = day/month;timeformat=1                ; 0 = 0:00am ; 1 (default) = 0h00, 2 = 0:00;contrast=8                  ; define the contrast of the LCD. From 0 to 15. Default = 8;country=us                  ; country (ccTLD) for dial tone frequency. See README, default = us;ringvolume=2                ; ring volume : 0,1,2,3, can be overrided by Dial(), default = 2ringstyle=3                 ; ring style : 0 to 7, can be overrided by Dial(), default = 3callhistory=1               ; 0 = disable, 1 = enable call history, default = 1callerid=&quot;Customer Support&quot; &amp;lt;555-234-5678&amp;gt;context=michael             ; context, default=&quot;default&quot;mailbox=2001                ; Specify the mailbox number. Used by Message Waiting Indication;linelabel=&quot;Support&quot;         ; Softkey label for the next line=&amp;gt; entry, 9 char max.;extension=line               ; Add an extension into the dialplan. Only valid in context specified previously.                             ; none=don't add (default), ask=prompt user, line=use the line numberline =&amp;gt; 101                 ; Only one line by device is currently supported.                             ; Beware ! only bookmark and softkey entries are allowed after line=&amp;gt;;bookmark=Hans C.@123        ; Use a softkey to dial 123. Name : 9 char max;bookmark=Mailbox@011@54     ; 54 shows a mailbox icon. See #define FAV_ICON_ for other values (32 to 63)bookmark=Test@*@USTM/phone1  ; Display an icon if violet is connected (dynamic), only for unistim device;bookmark=4@Pager@54321@51   ; Display a pager icon and dial 54321 when softkey 4 is pressedI then added the following lines in the extensions.conf file;exten =&amp;gt; 100,1,Dial(USTM/100@phone1)exten =&amp;gt; 101,1,Dial(USTM/101@phone2)It's not to complicated after you spend some time with it.Good Luck!<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment52]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Sandeep]]  &amp;mdash;  [-22 August 2012, 05:14-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Mark,What's really neat is that the i2002 pnoehs were still running the UNIStim stack with firmware 0604DAD and 0604DBG (no SIP firmware available for the i2002/i2004 pnoehs). Thanks to the efforts of  and others they were able to reverse engineer the UNIStim stack and provide the channel driver for using Nortel's proprietary protocol on Asterisk.I will comment that it took me about 30 minutes to realize that you couldn't just pickup the handset and dial a number. You had to pickup the handset, dial the phone number and then select the softkey labeled  Call . I spent that first 30 minutes running packet traces trying to figure out if I had a G.711/GSM codec issue or what the problem was.Thanks again for the comment!<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment53]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Mulker]]  &amp;mdash;  [-22 August 2012, 06:00-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I am just installing an asetsirk server into my small business, I have 8 Grandstream 2000 phones for hte initial deployment. These are configured and working fine. I am replaceing a Nortel BCM50 and I have 3 IP phones I would LOVE to get working on the system.I am on CentOS 5.2 like you, and used hte AsteriskNOW 1.6Beta for my base intstall of everything.Can I get a DETAILED instruction on how you got the nortels to work? Heck I would even pay you fo rhte consult to help me.. I truely like the nortel phones and it would save me about $400 if I can re-use the 3 IP phones I have.[removed by moderator]PS: I am not a  Phone Guy' so this is all new to me, I am a MCSE/T type.<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment54]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Mohammed]]  &amp;mdash;  [-29 August 2012, 10:06-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Hi Sir,<br />I need to know how to register outbound trunk in Opensips which required username and password?<br />for example in asterisk it is (register =&amp;gt; username:password@server-ip:5060), How can i do this in Opensips?<br /><br />Thanks in advanced<br />Mohammed<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment55]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~Johan]]  &amp;mdash;  [-04 September 2012, 15:20-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I have the basic load-balance configuration as written above. <br />One proxy, two end servers.<br /><br />As test I have setup a call to server1 and server2.<br />Then I pull the network cable out of server2.<br /><br />Problem is that the call stays connected to server2.<br />How can I configure that the proxy will send a BYE to both ends, when a server is down (lb_status sees it's down).<br />I want the call to disconnect, not to proceed on the other server.<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment56]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~anand]]  &amp;mdash;  [-11 February 2013, 10:26-]  <br />&gt;&gt;messageitem&lt;&lt;<br />hiii<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment57]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~sonu]]  &amp;mdash;  [-11 February 2013, 12:01-]  <br />&gt;&gt;messageitem&lt;&lt;<br />I have two asterisk box,How i can verify both are alive or any one goesdown using opensips.cgf<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment58]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~BFSP]]  &amp;mdash;  [-24 February 2013, 01:58-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Is there a way to use the receiving interface IP as the resource parameter in LB? This would greatly simplify using the correct table when listening on multiple interfaces on a single server.<br /><br />if (!load_balance($Ri,&quot;transc;pstn&quot;)) {<br />      sl_send_reply(&quot;500&quot;,&quot;Service full&quot;);<br />      exit;<br />}<br /><br />&gt;&gt;&lt;&lt;<br /><br />[[#comment59]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~BFSP]]  &amp;mdash;  [-24 February 2013, 02:07-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Looks like there is a solution using a transformation. <br /><br />$var(ip) = $Ri{ip.pton};<br /><br />if (!load_balance(&quot;$var(ip)&quot;,&quot;transc;pstn&quot;)) {<br />      sl_send_reply(&quot;500&quot;,&quot;Service full&quot;);<br />      exit;<br />}<br />&gt;&gt;&lt;&lt;<br /><br />[[#comment60]](:nl:)&gt;&gt;messagehead&lt;&lt;<br />!!!!![[~BFSP]]  &amp;mdash;  [-28 February 2013, 04:05-]  <br />&gt;&gt;messageitem&lt;&lt;<br />Big let down. Doesn't work. I didn't realize the {ip.pton} transformation literally transforms the value into ASCII characters representing the binary value. <br />&gt;&gt;&lt;&lt;<br /><br />(:commentboxchrono:)</div></div></div>
      <div class='diffrestore'><a href="javascript:if(confirm(%27http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1366822745:1366822745:&preview=y  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1366822745:1366822745:&preview=y%27" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit&restore=diff:1366822745:1366822745:&preview=y">Restore</a></div></div></div>
  
<!--PageRightFmt--><!--/PageRightFmt--></td>
</tr></table>
<!--PageFooterFmt-->
  <div id='wikifoot'>
  <hr class="bottomline" /></td>
    <div class='footnav'>
	
      <a rel="nofollow" href="Tutorials-LoadBalancing-action=edit.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=edit">Edit</a> |
      <a rel="nofollow" href="Tutorials-LoadBalancing-action=diff.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=diff">History</a> |
      <a rel="nofollow" href="Tutorials-LoadBalancing-action=print.htm" tppabs="http://www.opensips.org/Documentation/Tutorials-LoadBalancing?action=print" target='_blank'>Print</a> |
      <a href="RecentChanges.htm" tppabs="http://www.opensips.org/Documentation/RecentChanges">Recent Changes</a> |
      <a href="javascript:if(confirm(%27http://www.opensips.org/Site/Search  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.opensips.org/Site/Search%27" tppabs="http://www.opensips.org/Site/Search">Search</a></div>
    <div class='lastmod'>Page last modified on December 29, 2014, at 10:34 AM</div></div>
<!--HTMLFooter-->
</div>
</body>
</html>
